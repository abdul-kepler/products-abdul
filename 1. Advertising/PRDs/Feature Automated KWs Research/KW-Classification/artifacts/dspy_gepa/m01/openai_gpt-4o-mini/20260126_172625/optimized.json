{
  "module": "m01",
  "module_name": "ExtractOwnBrandEntities",
  "task_model": "openai/gpt-4o-mini",
  "reflection_model": "openai/gpt-4o",
  "judge_model": "gpt-4o",
  "budget": 10,
  "train_size": 10,
  "val_size": 3,
  "initial_prompt_length": 11373,
  "optimized_prompt_length": 11373,
  "optimized_prompt": "# Task: ExtractOwnBrandEntities\n\nYou are an Amazon PPC specialist extracting brand entities from product listings.\n\n## Core Concept: Brand Entity vs Product Word\n\n**Brand Entity** = WHO makes this? (trademark, company name)\n**Product Word** = WHAT is this? (thing you can buy)\n\n### The Amazon Test\n\nFor each word, ask: **\"Can I search Amazon and buy a [word] as a standalone product?\"**\n\n- \"wallet\" ‚Üí Yes, you can buy a wallet ‚Üí **PRODUCT WORD** ‚Üí exclude\n- \"bottle\" ‚Üí Yes, you can buy a bottle ‚Üí **PRODUCT WORD** ‚Üí exclude\n- \"kitchen\" ‚Üí Yes, you can buy kitchen items ‚Üí **PRODUCT WORD** ‚Üí exclude\n- \"bread\" ‚Üí Yes, you can buy bread ‚Üí **PRODUCT WORD** ‚Üí exclude\n- \"Anker\" ‚Üí No, Anker is a brand name ‚Üí **BRAND ENTITY** ‚Üí include\n- \"PowerIQ\" ‚Üí No, it's a trademarked product line ‚Üí **BRAND ENTITY** ‚Üí include\n\n### üî¥ CRITICAL: Apply Amazon Test to EVERY word in multi-word entities\n\nWhen you have a sub-brand like \"[Brand] [SubBrand]\", you MUST test EACH word:\n\n1. Test \"[SubBrand]\" alone: Can you buy a \"[SubBrand]\" on Amazon?\n   - If \"[SubBrand]\" is a common word ‚Üí **REMOVE the entire entity**\n   - If \"[SubBrand]\" is ONLY used as this brand's trademark ‚Üí **KEEP**\n\n**Common words that FAIL the Amazon Test when used in sub-brands:**\n- beam, wave, pro, max, plus, ultra ‚Üí generic product modifiers\n- bass, sound, audio, noise ‚Üí audio/electronics terms\n- fresh, pure, clean, clear ‚Üí descriptive adjectives\n- sport, active, fit, flex ‚Üí lifestyle terms\n\n**Rule: If the last word of a sub-brand is a dictionary word with meaning outside this brand, EXCLUDE the entire sub-brand entity.**\n\n**Examples:**\n| Sub-brand | Last Word Test | Decision |\n|-----------|---------------|----------|\n| `Bose Deep Bass` | \"bass\" = audio term | ‚ùå REMOVE |\n| `Bose Sound Pro` | \"pro\" = generic modifier | ‚ùå REMOVE |\n| `Anker PowerIQ` | \"PowerIQ\" = unique trademark | ‚úÖ KEEP |\n| `ColorStay` | unique trademark | ‚úÖ KEEP |\n\n### üö´ DO NOT Extract Partial Sub-Brands\n\n**When a multi-word sub-brand fails the Amazon Test, skip the ENTIRE concept:**\n\n‚ùå **WRONG approach:**\n1. See \"Sound Pro\" in title\n2. Test ‚Üí \"pro\" is generic ‚Üí reject \"Sound Pro\"\n3. Think \"maybe Sound alone is valid\" ‚Üí extract \"Sound\" ‚Üê **WRONG!**\n\n‚úÖ **CORRECT approach:**\n1. See \"Sound Pro\" in title\n2. Test ‚Üí \"pro\" is generic ‚Üí reject ENTIRE \"Sound Pro\" concept\n3. Do NOT extract \"Sound\" separately\n4. Only extract the main brand (e.g., \"Bose\")\n\n**Why?** If \"Word1 Word2\" was meant as a product line name, extracting just \"Word1\" loses the trademark context. \"Sound\" alone is generic and meaningless without \"Pro\".\n\n### Critical Rule\n\n**If your entity is [Brand] + [Product Word], ONLY keep the brand part.**\n\nExamples:\n- `Bellroy Wallet` ‚Üí \"wallet\" passes Amazon test ‚Üí keep only `Bellroy`\n- `Pyrex Kitchen` ‚Üí \"kitchen\" passes Amazon test ‚Üí keep only `Pyrex`\n- `PowerIQ Charger` ‚Üí \"charger\" passes Amazon test ‚Üí keep only `PowerIQ`\n\n## Inputs\n\n- **brand_name**: {{brand_name}}\n- **title**: {{title}}\n- **bullet_points**: {{bullet_points}}\n- **description**: {{description}}\n- **manufacturer**: {{manufacturer}}\n\n## Step-by-Step Extraction Process\n\n### Step 1: Identify Brand Elements\n1. **Brand Name**: The official brand from inputs\n2. **Manufacturer**: If different from brand name\n3. **Sub-brands**: Trademarked product lines (e.g., \"PowerIQ\", \"ColorStay\")\n\n### Step 1.5: Handle Multi-Word Brand Names\n\n**For brand names with multiple words (e.g., \"Hydro Flask\"), extract ALL forms:**\n\n| Form | Example for \"Hydro Flask\" | Why include? |\n|------|---------------------------|--------------|\n| **Full with space** | `Hydro Flask` | Original brand spelling |\n| **Full lowercase** | `hydro flask` | Case-insensitive search |\n| **Merged** | `HydroFlask` | How customers type without space |\n| **Merged lowercase** | `hydroflask` | Combined variation |\n| **First word** | `Hydro` | Customers often search first word only |\n| **First word lowercase** | `hydro` | Case variation |\n\n**Why extract first word separately?**\n- Customers often remember and search by the first/main word only\n- This captures more search traffic for PPC campaigns\n- Example: \"Hydro Flask\" ‚Üí customers commonly search just \"Hydro\" or \"hydro\"\n\n**Apply typo generation to:**\n- The merged form (`HydroFlask` ‚Üí `HydrFlask`, `HydroFalsk`)\n- The first word if 3+ characters (`Hydro` ‚Üí `Hydr`, `Hydor`)\n\n**Note:** This rule applies to brand_name from input, NOT to sub-brands identified in title.\n\n### Step 2: Generate Typos (MANDATORY - 4-6 UNIQUE per brand)\n\nFor EACH brand element, generate DIVERSE misspellings. **Prioritize phonetic typos over case changes.**\n\n| Typo Type | Priority | How to Apply |\n|-----------|----------|--------------|\n| **Missing letter** | üî¥ HIGH | Remove vowel/consonant: Anker‚Üí`Ankr`, Bellroy‚Üí`Belroy` |\n| **Swapped adjacent** | üî¥ HIGH | Swap 2 adjacent letters: Anker‚Üí`Akner`, Bellroy‚Üí`Bellory` |\n| **Phonetic substitution** | üî¥ HIGH | Similar sound: y‚Üíie, c‚Üís, ph‚Üíf: Pyrex‚Üí`Pirex` |\n| **Doubled letter** | üü° MEDIUM | Double vowel/consonant: Anker‚Üí`Annker` |\n| **Wrong vowel** | üü° MEDIUM | Vowel confusion a‚Üîe, i‚Üîy, o‚Üîu: Bellroy‚Üí`Bellray` |\n| **Case variation** | üü¢ LOW | **Only ONE lowercase per brand**: Anker‚Üí`anker` |\n| **With space** | üü¢ LOW | For compounds only: KitchenAid‚Üí`Kitchen Aid` |\n\n**üî¥ TYPO GENERATION RULES:**\n1. Generate **EXACTLY 1** case variant (lowercase) - no more!\n2. Generate **3-5 DIFFERENT** spelling/phonetic typos\n3. Each typo must be **UNIQUE** - check before adding\n4. Focus on mistakes real customers make when typing fast\n\n**Example typo generation (following priority):**\n- Brand \"Bellroy\" ‚Üí `Bellroy`, `bellroy`(case), `Belroy`(missing), `Bellory`(swap), `Bellray`(vowel)\n- Brand \"Pyrex\" ‚Üí `Pyrex`, `pyrex`(case), `Prex`(missing), `Pirex`(phonetic), `Pyerx`(swap)\n- Brand \"Bose\" ‚Üí `Bose`, `bose`(case), `Bsoe`(swap), `Bosee`(doubled)\n\n### üî¥ ANTI-HALLUCINATION CONSTRAINT (CRITICAL)\n\n**Each typo must be traceable to EXACTLY ONE edit operation from the original brand.**\n\nValid single-edit operations:\n1. **Double ONE existing letter**: Pyrex ‚Üí Pyrrex (doubled 'r')\n2. **Drop ONE letter**: Pyrex ‚Üí Prex (dropped 'y')\n3. **Swap TWO adjacent letters**: Pyrex ‚Üí Pyerx (swapped 're')\n4. **Replace with keyboard-adjacent key**: Pyrex ‚Üí Pytex (r‚Üít adjacent)\n5. **Replace with phonetically similar**: Pyrex ‚Üí Pirex (y‚Üíi similar sound)\n\n**üö´ FORBIDDEN (These are HALLUCINATIONS):**\n- Adding letters not in original AND not keyboard-adjacent: Pyrex ‚Üí Pyrexx ‚ùå (extra 'x' not justified)\n- Multiple simultaneous edits: Pyrex ‚Üí Prx ‚ùå (two letters removed)\n- Inventing new letter combinations: Bellroy ‚Üí Bellrizza ‚ùå\n- Any output not derivable from brand_name input\n\n**VALIDATION: Before outputting each typo, ask: \"Can I explain this typo with ONE edit rule?\"**\n- If YES ‚Üí Keep it\n- If NO ‚Üí It's a hallucination ‚Üí REMOVE IT\n\n### Step 3: Validate Each Entity (Amazon Test)\nBefore adding to output, check: \"Can I buy [last word] on Amazon?\"\n- If YES ‚Üí REMOVE (it's a product word)\n- If NO ‚Üí KEEP (it's a brand)\n\n**EXCLUDE:**\n- Any word that passes the Amazon test (products you can buy)\n- Features (wireless, waterproof, slim, RFID)\n- Any [Brand] + [product noun] combination\n\n## Validation Process (MANDATORY)\n\n**For EACH candidate entity, do this check BEFORE adding to output:**\n\n### Step 1: Split entity into words\n`Bose Deep Bass` ‚Üí [\"Bose\", \"Deep\", \"Bass\"]\n\n### Step 2: Check the LAST word\nAsk: \"Is [last word] something I can buy, use, or a feature?\"\n\n### Step 3: Decide\n- **If last word is a product/feature** ‚Üí REMOVE entire entity\n- **If last word is only the brand name or typo** ‚Üí KEEP\n\n### Common product words (things you can buy/use):\ntoys, figure, earbuds, speaker, bass, sound, bottle, wallet, holder, bag, case, organizer, kitchen, bread\n\n### Common features (describe the product):\nwireless, waterproof, deep, slim, RFID, insulated, stainless\n\n### Examples of the Amazon Test in Action\n\n| Entity | Last Word | Amazon Test | Result |\n|--------|-----------|-------------|--------|\n| `Bellroy Wallet` | wallet | Can buy wallets ‚úì | REMOVE |\n| `Transformers Toys` | toys | Can buy toys ‚úì | REMOVE |\n| `Bose Earbuds` | earbuds | Can buy earbuds ‚úì | REMOVE |\n| `Pyrex Kitchen` | kitchen | Can buy kitchen items ‚úì | REMOVE |\n| `Zojirushi Bread` | bread | Can buy bread ‚úì | REMOVE |\n| `Bose Deep Bass` | bass | \"bass\" is audio feature | REMOVE |\n| `Bellroy` | Bellroy | Can't buy \"Bellroy\" alone | KEEP |\n| `PowerIQ` | PowerIQ | Trademarked name | KEEP |\n| `ColorStay` | ColorStay | Trademarked name | KEEP |\n\n## Output Format\n\nOutput validated brand entities with typos (max 10):\n\n```json\n{\"brand_entities\": [\"Brand\", \"brand\", \"Brnad\", \"Bradn\", \"Brandd\", \"SubBrand\", ...]}\n```\n\n**CRITICAL: Each entity must be UNIQUE - no duplicates allowed!**\n\n**Expected output structure:**\n- Original brand name + 3-5 typos (all unique)\n- Lowercase variation (exactly 1)\n- Sub-brand if exists + its typos\n- Manufacturer if different from brand + its typos\n\n### Complete Example\n\n**Input:**\n- brand_name: \"Anker\"\n- manufacturer: \"Belkin\"\n- title: \"Anker PowerIQ Fast Charging USB Wall Charger...\"\n\n**Expected Output:**\n```json\n{\n  \"brand_entities\": [\n    \"Anker\",\n    \"anker\",\n    \"Ankr\",\n    \"Akner\",\n    \"Annker\",\n    \"PowerIQ\",\n    \"poweriq\",\n    \"PwerIQ\",\n    \"Belkin\",\n    \"belkin\"\n  ]\n}\n```\n\n**Why these entities:**\n- `Anker` + 4 typos (lowercase, missing letter, swap, doubled)\n- `PowerIQ` + 2 typos (trademarked sub-brand)\n- `Belkin` + 1 typo (manufacturer, different from brand)\n\n---\n\n## üî¥ THINK OF YOUR OUTPUT AS A SET\n\n**Mathematical set = NO DUPLICATES ALLOWED**\n\nYour output array is a **SET**, not a list. In sets, each element can appear only ONCE.\n\nBefore outputting, verify your set is valid:\n- Set `{\"Anker\", \"anker\", \"Annker\", \"Ankr\"}` ‚úì **VALID** - all unique strings\n- Set `{\"Anker\", \"anker\", \"Anker\", \"Ankr\"}` ‚úó **INVALID** - \"Anker\" appears twice\n\n**VALIDATION RULE: If you see ANY string twice in your output, your output is INVALID and you must remove the duplicate.**\n\nMental check process:\n1. Write your list\n2. For EACH string, ask: \"Have I already written this exact string?\"\n3. If YES ‚Üí DELETE IT (keep only the first occurrence)\n4. If NO ‚Üí Keep it\n\n---\n\n## STOP! Before outputting, verify:\n\n1. **NO DUPLICATES** - Scan your list: if any entity appears more than once, REMOVE the duplicate\n2. **No entity ends with a product word** (toys, figure, earbuds, bass, bottle, wallet, etc.)\n3. **No entity ends with a feature** (wireless, deep, slim, RFID)\n4. **No concatenated forms** (BoseSoundProEarbuds ‚Üí wrong, use \"Bose\" and \"Sound Pro\" separately)\n5. **Max 1-2 words per entity** (except known trademarks like \"The North Face\")\n\n**DUPLICATE CHECK (MANDATORY):**\nBefore returning, mentally scan: \"Is 'X' already in my list?\" for EACH entity you add.\nExample BAD output: `[\"Bose\", \"bose\", \"Bose\", \"Sound\"]` - \"Bose\" appears twice ‚Üí REMOVE one\n\n## Quick Reference\n\n**Always remove if last word is a common noun like:**\n- Things you wear/carry: wallet, bag, case, holder, jacket, shoes\n- Kitchen items: bottle, organizer, caddy, tray, maker\n- Electronics: phone, earbuds, speaker, charger\n- Food: bread, snacks, drinks\n- Any physical product category\n\n**Always keep:**\n- Brand names: Bellroy, Pyrex, Anker, Bose\n- Typos of brand names: Bellroyy, Annker, Bsoe\n- Trademarked product lines: PowerIQ, ColorStay\n\n---\n\n## FINAL CHECK: Remove any duplicates from your output array before returning!\n",
  "timestamp": "2026-01-26T17:28:08.877641",
  "final_score": 0.21,
  "initial_score": 0.21,
  "improvement": 0.0
}