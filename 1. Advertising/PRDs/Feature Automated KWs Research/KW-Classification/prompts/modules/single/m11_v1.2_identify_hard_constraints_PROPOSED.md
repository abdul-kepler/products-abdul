# Module 11 (V1.2 - PROPOSED): Identify Hard Constraints

## Version History
| Version | Date | Changes |
|---------|------|---------|
| V1.1 | Original | Base version |
| V1.2 | 2026-01-30 | Added: Device Compatibility Check, Mandatory Reasoning Format, Cheapest Version Test |

## Changes from V1.1
This version addresses 3 issues identified in the M11 Multi-Agent Evaluation Dashboard (score: 2.64/5):
1. **FALSE_NEGATIVE**: Module missed device compatibility constraints
2. **REASONING_ERROR**: "Complete Removal Test" not applied consistently
3. **REASONING_ERROR**: MECHANISM vs QUALITY distinction unclear

---

## Purpose

Determine which product attributes are non-negotiable for the product to function.

---

## The Hard Constraint Test

For each attribute, apply this three-step test:

### Step 1: The "Complete Removal" Test

> **"If this attribute were COMPLETELY ABSENT (not different value, but GONE), would the product be PHYSICALLY UNABLE to perform its core function?"**

Examples:
- Oven Mitt without ANY heat resistance → Burns hands → YES, fails test → HARD CONSTRAINT
- Earbuds without ANY Bluetooth → No wireless audio → But wired audio still works → NOT about version
- Earbuds without Bluetooth 5.2 (but has 4.0) → Still transmits audio → NO, not hard constraint

### Step 2: The "Mechanism vs Quality" Filter

> **"Is this attribute THE MECHANISM that enables the function, or a QUALITY MODIFIER of the mechanism?"**

| Type | Example | Hard Constraint? |
|------|---------|------------------|
| MECHANISM | Heat resistance enables protection | Could be YES |
| QUALITY | 500F rating (how much protection) | NO |
| MECHANISM | Speaker drivers enable audio | Could be YES |
| QUALITY | Deep Bass (frequency emphasis) | NO |
| QUALITY | Bluetooth 5.2 (version level) | NO |

#### [NEW] The "Cheapest Version" Test for MECHANISM vs QUALITY

> **"If I replaced this with the CHEAPEST possible version, would the product still DO its core function?"**

| Attribute | Cheapest Version | Still Works? | Type |
|-----------|------------------|--------------|------|
| Deep Bass | Tiny mono speaker | Still plays audio | QUALITY |
| Bluetooth 5.2 | Bluetooth 4.0 | Still transmits | QUALITY |
| Heat Resistant | Any heat blocking material | Still blocks heat | MECHANISM |
| iPhone 15 Fit | Wrong size case | CANNOT protect | MECHANISM |

**Simple Rule:**
- **MECHANISM** = The product **CANNOT** do its job without it
- **QUALITY** = The product **DOES its job worse** without it

> "Worse" ≠ "Unable"

### Step 3: The "Validated Use" Alignment

> **"Does the Validated Use REQUIRE this specific attribute, or just require the product category to exist?"**

| Validated Use | Attribute | Required? | Reasoning |
|---------------|-----------|-----------|-----------|
| "Heat protection when cooking" | Heat Resistant | YES | Protection = heat resistance |
| "Listening to audio" | Deep Bass | NO | Listening does not require bass |
| "Drawing lines around eyes" | Waterproof | NO | Drawing does not require waterproof |
| "Protecting phone from damage" | iPhone 15 Fit | YES | Protection requires physical fit |

---

## [NEW] MANDATORY: Device Compatibility Check

> **BEFORE concluding 0 hard constraints, you MUST perform this check.**

### Ask: "Does this product connect to, fit, or work with a SPECIFIC device?"

| Product Type | Compatibility Question | If YES → Hard Constraint |
|--------------|----------------------|--------------------------|
| **Earbuds/Headphones** | Do they require specific phone/OS? (iOS only, Android only) | OS Compatibility |
| **Phone Cases** | Do they fit a specific device model? | Device Fit |
| **Cables/Chargers** | Do they have a specific connector type? | Connector Type |
| **Screen Protectors** | Do they fit a specific screen size/model? | Device Fit |
| **Accessories** | Do they attach to/work with specific product? | Product Compatibility |
| **Software/Apps** | Do they require specific OS version? | OS Compatibility |

### Examples:

**Earbuds - WITH compatibility constraint:**
```
Product: "AirPods Pro 2nd Gen"
Check: Does it require specific device? → YES, requires iPhone/iOS
Result: "iOS Compatibility" IS a hard constraint
```

**Earbuds - WITHOUT compatibility constraint:**
```
Product: "Generic Bluetooth Earbuds"
Check: Does it require specific device? → NO, works with any Bluetooth device
Result: 0 hard constraints
```

**If you're unsure:** Look for phrases like "for iPhone", "Android only", "requires iOS 15+", "compatible with [specific device]" in the product title/description.

---

## STOP: These are NEVER Hard Constraints

Before marking ANY attribute as hard constraint, check these categories:

### 1. Technology Versions (NEVER)
The VERSION of a technology is quality, not existence:
- Bluetooth 5.2 - NO, Bluetooth 4.0 still plays audio
- WiFi 6 - NO, WiFi 5 still connects
- USB 3.0 - NO, USB 2.0 still transfers data

### 2. Durability/Longevity Features (NEVER)
Features that make product LAST LONGER don't enable function:
- Waterproof - NO, Product works when dry
- Rustproof - NO, Product works before it rusts
- Smudge-proof - NO, Product works even if it smudges later
- Long-lasting - NO, Product works even if short-lived

### 3. Performance Specs (NEVER)
Quantitative specs are quality levels:
- 32-hour battery - NO, 8-hour battery still plays audio
- 26lbs/day ice - NO, 10lbs/day still makes ice
- 24-hour wear - NO, 4-hour wear still draws lines

### 4. Marketing Differentiators (NEVER)
Features highlighted to differentiate from competitors:
- Deep Bass Sound - NO, Regular sound is still audio
- Self-Cleaning - NO, Manual cleaning works
- Speed Charging - NO, Regular charging works
- VoiceAware - NO, Calls work without it

### 5. Material Choices (NEVER)
Alternative materials perform same function:
- Stainless Steel bottle - NO, Plastic holds water too
- Silicone oven mitt - NO, Cotton protects from heat too
- Bamboo tray - NO, Plastic serves food too
- 304 Stainless Steel - NO, Regular steel organizes items too
- Bamboo organizer - NO, Plastic organizes too

### 6. Product-Defining Mechanisms (NEVER)
The mechanism that DEFINES what the product IS cannot be a constraint - it's just saying "this product must be this product":
- Ice Maker needs "ice making mechanism" - NO, Tautology: "ice maker makes ice"
- Phone Holder needs "holding mechanism" - NO, Tautology: "holder holds things"
- Suction mount needs "suction" - NO, That's what makes it a suction mount
- Magnetic holder needs "magnets" - NO, That's what makes it magnetic

The question is: What EXTRA attributes beyond "being this product type" are required?

### 7. Convenience/Usability Features (NEVER)
Features that make product easier to use but don't enable core function:
- Handles on tray - NO, Can carry tray without handles
- Built-in sharpener - NO, Can sharpen pencil separately
- Foldable design - NO, Non-foldable still works
- 360 degree swivel - NO, Fixed angle still holds phone

### 8. Size/Dimensions (Almost NEVER)
Size is usually a preference, not a requirement:
- 15x10 inch tray - NO, 12x8 still serves food
- 32oz bottle - NO, 16oz still hydrates
- 11-inch figure - NO, 6-inch still plays

**Exception: Device compatibility (e.g., iPhone 15 case MUST fit iPhone 15)**

---

## Input

**Product Title:** {{title}}

**Bullet Points:**
{{bullet_points}}

**Description:**
{{description}}

**Validated Intended Use:** {{validated_use}}

**Product Type Taxonomy:**
{{taxonomy}}

**Attributes:**
{{attribute_table}}

**Product Attributes:**
{{product_attributes}}

---

## Worked Examples

### Example A: True Wireless Earbuds (Generic)
**Validated Use:** "Listening to audio"

| Attribute | Step 1: Remove entirely? | Step 2: Mechanism or Quality? | Step 3: Use requires it? | HARD? |
|-----------|-------------------------|-------------------------------|-------------------------|-------|
| Bluetooth 5.2 | Still has Bluetooth capability | QUALITY (version) | "Listening" works with any BT | NO |
| Deep Bass | Still produces sound | QUALITY (frequency) | "Listening" = any audio | NO |
| 32hr Battery | Still plays audio | QUALITY (duration) | "Listening" works with less | NO |
| Water Resistant | Still plays audio | DURABILITY feature | "Listening" does not need waterproof | NO |

**Device Compatibility Check:** Generic Bluetooth - works with any device → NO constraint

**Result: 0 hard constraints**

**Key insight:** "Listening to audio" requires speakers that produce sound. Everything else (bass quality, battery length, water resistance) improves experience but doesn't enable the core function.

---

### [NEW] Example A2: Apple AirPods Pro (Device-Specific)
**Validated Use:** "Listening to audio"

| Attribute | Step 1: Remove entirely? | Step 2: Mechanism or Quality? | Step 3: Use requires it? | HARD? |
|-----------|-------------------------|-------------------------------|-------------------------|-------|
| iOS Compatibility | Cannot pair with iPhone without it | MECHANISM (enables connection) | YES - product designed for Apple | YES |
| Active Noise Cancellation | Still plays audio | QUALITY (feature) | "Listening" works without ANC | NO |
| Spatial Audio | Still plays audio | QUALITY (feature) | "Listening" works without it | NO |

**Device Compatibility Check:** "For iPhone" in title → iOS required → YES, constraint

**Result: 1 hard constraint** (iOS Compatibility)

**Key insight:** AirPods are specifically designed for Apple ecosystem. Without iOS compatibility, they cannot perform their intended function with the target device.

---

### Example B: iPhone 15 Pro Case
**Validated Use:** "Protecting phone from damage"

| Attribute | Step 1: Remove entirely? | Step 2: Mechanism or Quality? | HARD? |
|-----------|-------------------------|-------------------------------|-------|
| iPhone 15 Pro Fit | Case doesn't attach | MECHANISM (fit enables protection) | YES |
| Silicone Material | Other materials protect | QUALITY choice | NO |
| MagSafe | Case still protects | FEATURE addition | NO |
| Black Color | Case still protects | AESTHETIC | NO |

**Device Compatibility Check:** "iPhone 15 Pro" in title → specific device fit required → YES

**Result: 1 hard constraint** (Device Compatibility)

**Key insight:** iPhone 14 case physically CANNOT protect iPhone 15 - wrong dimensions. This is physical incompatibility.

---

### Example C: Oven Mitt
**Validated Use:** "Heat protection when cooking"

| Attribute | Step 1: Remove entirely? | Step 2: Mechanism or Quality? | HARD? |
|-----------|-------------------------|-------------------------------|-------|
| Heat Resistant | Burns hands = no protection | MECHANISM (enables protection) | YES |
| 500F rating | 400F still protects | QUALITY (how much) | NO |
| Silicone Material | Cotton also protects | MATERIAL choice | NO |
| Slip-resistant | Still protects from heat | CONVENIENCE | NO |

**Device Compatibility Check:** Not a device accessory → N/A

**Result: 1 hard constraint** (Essential Physical Property)

**Key insight:** "Heat protection" literally requires heat resistance. Without it, you burn. The specific temperature rating is quality.

---

### Example D: Eyeliner Pencil
**Validated Use:** "Drawing lines around eyes"

| Attribute | Step 1: Remove entirely? | Step 2: Mechanism or Quality? | HARD? |
|-----------|-------------------------|-------------------------------|-------|
| Waterproof | Still draws lines | DURABILITY (lasts longer) | NO |
| Smudge-proof | Still draws lines | DURABILITY (stays put) | NO |
| 24-Hour Wear | Still draws lines | DURABILITY (longevity) | NO |
| Built-in Sharpener | Still draws lines | CONVENIENCE | NO |

**Device Compatibility Check:** Not a device accessory → N/A

**Result: 0 hard constraints**

**Key insight:** "Drawing lines around eyes" = making visible marks. A basic pencil does this. Waterproof makes lines LAST longer, not EXIST.

---

### Example E: Water Bottle
**Validated Use:** "Carrying drinks for hydration"

| Attribute | Step 1: Remove entirely? | Step 2: Mechanism or Quality? | HARD? |
|-----------|-------------------------|-------------------------------|-------|
| Stainless Steel | Plastic holds liquid too | MATERIAL choice | NO |
| 24oz Size | Any size holds liquid | QUALITY (capacity) | NO |
| Insulated | Non-insulated holds liquid | FEATURE (temperature) | NO |
| BPA-Free | Still holds liquid | SAFETY feature | NO |

**Device Compatibility Check:** Not a device accessory → N/A

**Result: 0 hard constraints**

---

## Pre-Output Checklist

Before returning hard_constraints, verify EACH attribute passes ALL checks:

- [ ] Would removing this attribute make the product PHYSICALLY UNABLE to perform?
- [ ] Is this the MECHANISM of function (not quality/durability/convenience)?
- [ ] Does the validated use REQUIRE this specific attribute?
- [ ] Is this NOT a technology version, durability feature, performance spec, or marketing claim?
- [ ] Is this NOT a material choice, product-defining mechanism, convenience feature, or size specification?
- [ ] Would a reasonable person say "this product is BROKEN" without this attribute?
- [ ] **[NEW]** Did you perform the Device Compatibility Check?

**If ANY check fails - NOT a hard constraint**

---

## Expected Distribution

Most consumer products have **0-1 hard constraints**:

| Count | Product Types |
|-------|---------------|
| **0** | Water bottles, generic earbuds, trays, makeup, toys, organizers, ice makers, jackets, generic phone holders |
| **1** | Phone cases (device fit), oven mitts (heat resistance), cables (connector type), device-specific earbuds (OS compatibility) |
| **2+** | Extremely rare - only multi-compatibility products |

**WARNING: If you identified 2+ hard constraints, review each one again using the checklist.**

---

## [NEW] MANDATORY Reasoning Format

You MUST analyze EACH attribute using this exact format:

```
[Attribute Name]:
  Step 1 (Complete Removal): If [attribute] is COMPLETELY ABSENT, can product still [validated use]?
  → Answer: [YES can still function / NO cannot function] because [specific reason]

  Step 2 (Mechanism vs Quality): Is this THE mechanism that enables function, or a quality modifier?
  → Answer: [MECHANISM / QUALITY] because [specific reason]
  → Cheapest Version Test: Would a $1 version still work? [YES/NO]

  Step 3 (Validated Use Alignment): Does '[validated use]' specifically REQUIRE [attribute]?
  → Answer: [YES required / NO not required] because [specific reason]

  → CONCLUSION: [HARD CONSTRAINT / NOT A HARD CONSTRAINT]
```

---

## Output Format

You MUST use Chain of Thought reasoning with the MANDATORY format above. First, analyze each attribute step-by-step in the "reasoning" field, then provide your final answer as a simple list.

Return JSON with this structure:

```json
{
  "reasoning": "Step-by-step analysis using mandatory format...",
  "hard_constraints": ["AttributeName"],
  "confidence": 0.0-1.0
}
```

### Example with 1 hard constraint (Oven Mitt):

```json
{
  "reasoning": "Analyzing Oven Mitt for 'Heat protection when cooking'.\n\nHeat Resistant:\n  Step 1 (Complete Removal): If heat resistance is COMPLETELY ABSENT, can product still provide heat protection?\n  → Answer: NO cannot function because without any heat resistance, hands will burn - no protection provided.\n  Step 2 (Mechanism vs Quality): Is this THE mechanism or quality modifier?\n  → Answer: MECHANISM because heat resistance IS what enables protection.\n  → Cheapest Version Test: Would a $1 heat-resistant material still protect? YES.\n  Step 3 (Validated Use Alignment): Does 'Heat protection when cooking' REQUIRE heat resistance?\n  → Answer: YES required because protection literally means blocking heat.\n  → CONCLUSION: HARD CONSTRAINT\n\n500F rating:\n  Step 1 (Complete Removal): If 500F rating is absent but still heat resistant, can product protect?\n  → Answer: YES can still function because 400F rating still blocks heat.\n  Step 2 (Mechanism vs Quality): Is this THE mechanism or quality modifier?\n  → Answer: QUALITY because it's HOW MUCH protection, not WHETHER protection exists.\n  → Cheapest Version Test: Would lower temp rating still protect? YES.\n  Step 3 (Validated Use Alignment): Does 'Heat protection' REQUIRE exactly 500F?\n  → Answer: NO not required because any heat resistance provides protection.\n  → CONCLUSION: NOT A HARD CONSTRAINT\n\nDevice Compatibility Check: Not a device accessory → N/A\n\nFinal: 1 hard constraint identified.",
  "hard_constraints": ["Heat Resistance"],
  "confidence": 0.95
}
```

### Example with 0 hard constraints (Generic Earbuds):

```json
{
  "reasoning": "Analyzing Generic Bluetooth Earbuds for 'Listening to audio'.\n\nBluetooth 5.2:\n  Step 1 (Complete Removal): If Bluetooth 5.2 is absent, can product still play audio?\n  → Answer: YES can still function because Bluetooth 4.0 or wired connection still transmits audio.\n  Step 2 (Mechanism vs Quality): Is this THE mechanism or quality modifier?\n  → Answer: QUALITY because 5.2 is a VERSION - the mechanism is 'Bluetooth' not '5.2'.\n  → Cheapest Version Test: Would Bluetooth 4.0 still transmit audio? YES.\n  Step 3 (Validated Use Alignment): Does 'Listening to audio' REQUIRE Bluetooth 5.2?\n  → Answer: NO not required because listening works with any audio transmission method.\n  → CONCLUSION: NOT A HARD CONSTRAINT\n\nDeep Bass:\n  Step 1 (Complete Removal): If Deep Bass is absent, can product still play audio?\n  → Answer: YES can still function because regular speakers still produce sound.\n  Step 2 (Mechanism vs Quality): Is this THE mechanism or quality modifier?\n  → Answer: QUALITY because bass is frequency emphasis, not audio existence.\n  → Cheapest Version Test: Would $1 earbuds without bass enhancement still play audio? YES.\n  Step 3 (Validated Use Alignment): Does 'Listening to audio' REQUIRE deep bass?\n  → Answer: NO not required because listening = hearing sound, any frequency works.\n  → CONCLUSION: NOT A HARD CONSTRAINT\n\nDevice Compatibility Check: 'Generic Bluetooth' - works with any Bluetooth device → NO constraint\n\nFinal: 0 hard constraints identified.",
  "hard_constraints": [],
  "confidence": 0.9
}
```
