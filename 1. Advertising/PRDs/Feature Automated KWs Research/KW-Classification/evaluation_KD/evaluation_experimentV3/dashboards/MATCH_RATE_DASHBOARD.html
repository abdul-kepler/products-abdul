<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Match Rate Dashboard - Expected vs Actual</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: #f5f7fa;
            padding: 25px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 28px;
            color: #1a1a2e;
            margin-bottom: 8px;
        }

        .header p {
            color: #666;
            font-size: 14px;
        }

        /* Summary Cards */
        .summary-row {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 20px 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            text-align: center;
            min-width: 180px;
        }

        .summary-card .label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .summary-card .value {
            font-size: 32px;
            font-weight: 700;
        }

        .summary-card .value.exact { color: #27ae60; }
        .summary-card .value.semantic { color: #3498db; }
        .summary-card .value.mismatch { color: #e74c3c; }
        .summary-card .value.total { color: #1a1a2e; }

        .summary-card .count {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }

        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 25px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 4px;
        }

        .legend-color.exact { background: #27ae60; }
        .legend-color.semantic { background: #3498db; }
        .legend-color.mismatch { background: #e74c3c; }

        /* Chart Container */
        .chart-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            margin-bottom: 30px;
        }

        .chart-section h2 {
            font-size: 16px;
            color: #1a1a2e;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .chart-container {
            height: 400px;
            position: relative;
        }

        /* Table */
        .table-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .table-section h2 {
            font-size: 16px;
            color: #1a1a2e;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        th {
            padding: 12px 10px;
            text-align: left;
            background: #f8f9fa;
            font-size: 11px;
            text-transform: uppercase;
            color: #666;
            font-weight: 600;
        }

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
        }

        .module-name {
            font-weight: 600;
            color: #1a1a2e;
        }

        .bar-cell {
            width: 300px;
        }

        .stacked-bar {
            display: flex;
            height: 24px;
            border-radius: 4px;
            overflow: hidden;
            background: #eee;
        }

        .bar-segment {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            color: white;
            min-width: 0;
        }

        .bar-segment.exact { background: #27ae60; }
        .bar-segment.semantic { background: #3498db; }
        .bar-segment.mismatch { background: #e74c3c; }

        .rate-cell {
            text-align: center;
            font-weight: 600;
        }

        .rate-cell.exact { color: #27ae60; }
        .rate-cell.semantic { color: #3498db; }
        .rate-cell.mismatch { color: #e74c3c; }

        .total-cell {
            text-align: center;
            color: #666;
        }

        /* Sort indicators */
        th.sortable {
            cursor: pointer;
            user-select: none;
        }

        th.sortable:hover {
            background: #e9ecef;
        }

        th.sortable::after {
            content: " ‚Üï";
            opacity: 0.3;
        }

        th.sorted-asc::after {
            content: " ‚Üë";
            opacity: 1;
        }

        th.sorted-desc::after {
            content: " ‚Üì";
            opacity: 1;
        }

        /* Definitions */
        .definitions {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .definitions h3 {
            font-size: 14px;
            color: #1a1a2e;
            margin-bottom: 12px;
        }

        .def-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .def-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid;
        }

        .def-item.exact { border-color: #27ae60; }
        .def-item.semantic { border-color: #3498db; }
        .def-item.mismatch { border-color: #e74c3c; }

        .def-item strong {
            display: block;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .def-item p {
            font-size: 11px;
            color: #666;
            line-height: 1.4;
        }

        /* Dashboard Explanation */
        .dashboard-explanation {
            max-width: 800px;
            margin: 0 auto 25px;
        }

        .explanation-box {
            background: linear-gradient(135deg, #e8f4fc 0%, #d6eaf8 100%);
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #3498db;
        }

        .explanation-box h3 {
            font-size: 14px;
            color: #2980b9;
            margin-bottom: 10px;
        }

        .explanation-box > p {
            font-size: 13px;
            color: #333;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .comparison-table {
            background: white;
            border-radius: 6px;
            padding: 12px;
        }

        .comp-row {
            display: flex;
            padding: 6px 0;
            border-bottom: 1px solid #eee;
        }

        .comp-row:last-child {
            border-bottom: none;
        }

        .comp-label {
            font-weight: 600;
            color: #2980b9;
            width: 140px;
            font-size: 12px;
        }

        .comp-value {
            color: #555;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Match Rate Dashboard</h1>
        <p>Expected vs Actual Output Comparison Across All Modules</p>
    </div>

    <div class="dashboard-explanation">
        <div class="explanation-box">
            <h3>What This Dashboard Shows</h3>
            <p><strong>Expected vs Actual Output Comparison</strong> - This dashboard compares the ground truth expected outputs in evaluation datasets against what the pipeline/model actually produced. Categories are derived from the <code>Issue_Type</code> column in full evaluation CSVs.</p>
            <div class="comparison-table">
                <div class="comp-row">
                    <span class="comp-label">Data Source:</span>
                    <span class="comp-value">full_evaluation_spreadsheet_20260114_134323.csv</span>
                </div>
                <div class="comp-row">
                    <span class="comp-label">Sample Size:</span>
                    <span class="comp-value">Unique Input Data samples per module (10-20 per module)</span>
                </div>
                <div class="comp-row">
                    <span class="comp-label">Exact Match:</span>
                    <span class="comp-value">"Model Correct" - output matches expected exactly</span>
                </div>
                <div class="comp-row">
                    <span class="comp-label">Semantic Match:</span>
                    <span class="comp-value">"Valid Difference" - different but equally valid output</span>
                </div>
                <div class="comp-row">
                    <span class="comp-label">Mismatch:</span>
                    <span class="comp-value">"Prompt Issue" + "Model Issue" - incorrect output</span>
                </div>
            </div>
        </div>
    </div>

    <div class="definitions">
        <h3>Match Categories</h3>
        <div class="def-grid">
            <div class="def-item exact">
                <strong>Exact Match</strong>
                <p>Output matches expected result exactly or with trivial differences. Model produced correct output.</p>
            </div>
            <div class="def-item semantic">
                <strong>Semantic Match</strong>
                <p>Output differs from expected but is equally valid. Includes valid alternatives, acceptable variations.</p>
            </div>
            <div class="def-item mismatch">
                <strong>Mismatch</strong>
                <p>Output does not match expected. Includes prompt issues, model errors, format problems, null outputs.</p>
            </div>
        </div>
    </div>

    <div class="summary-row" id="summaryRow">
        <!-- Generated by JavaScript -->
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color exact"></div>
            <span>Exact Match</span>
        </div>
        <div class="legend-item">
            <div class="legend-color semantic"></div>
            <span>Semantic Match</span>
        </div>
        <div class="legend-item">
            <div class="legend-color mismatch"></div>
            <span>Mismatch</span>
        </div>
    </div>

    <div class="chart-section">
        <h2>Match Rates by Module</h2>
        <div class="chart-container">
            <canvas id="matchRateChart"></canvas>
        </div>
    </div>

    <div class="table-section">
        <h2>Detailed Breakdown by Module</h2>
        <table id="matchTable">
            <thead>
                <tr>
                    <th class="sortable" data-sort="module">Module</th>
                    <th>Distribution</th>
                    <th class="sortable" data-sort="exact">Exact Match</th>
                    <th class="sortable" data-sort="semantic">Semantic Match</th>
                    <th class="sortable" data-sort="mismatch">Mismatch</th>
                    <th class="sortable" data-sort="total">Total</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <!-- Generated by JavaScript -->
            </tbody>
        </table>
    </div>

    <!-- NEW: Failure Analysis Section -->
    <div class="chart-section" style="margin-top: 30px;">
        <h2>üîç Failure Root Cause Analysis</h2>
        <p style="color: #666; font-size: 13px; margin-bottom: 20px;">
            Diagnostic breakdown of Semantic Mismatch and Mismatch categories to identify root causes for improvement.
        </p>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
            <!-- Semantic Mismatch Breakdown -->
            <div>
                <h3 style="font-size: 14px; color: #3498db; margin-bottom: 15px; border-bottom: 2px solid #3498db; padding-bottom: 8px;">
                    Semantic Mismatch Causes (65 samples)
                </h3>
                <div class="chart-container" style="height: 250px;">
                    <canvas id="semanticPieChart"></canvas>
                </div>
                <div id="semanticLegend" style="margin-top: 15px;"></div>
            </div>

            <!-- Mismatch Breakdown -->
            <div>
                <h3 style="font-size: 14px; color: #e74c3c; margin-bottom: 15px; border-bottom: 2px solid #e74c3c; padding-bottom: 8px;">
                    Mismatch Root Causes (83 samples)
                </h3>
                <div class="chart-container" style="height: 250px;">
                    <canvas id="mismatchPieChart"></canvas>
                </div>
                <div id="mismatchLegend" style="margin-top: 15px;"></div>
            </div>
        </div>
    </div>

    <!-- Module-Specific Failure Analysis -->
    <div class="table-section" style="margin-top: 30px;">
        <h2>üìä Module-Specific Failure Patterns</h2>
        <p style="color: #666; font-size: 13px; margin-bottom: 20px;">
            Top failure modes per module based on diagnostic rubric analysis. Use this to prioritize prompt/rubric improvements.
        </p>
        <table id="failureTable">
            <thead>
                <tr>
                    <th>Module</th>
                    <th>Primary Failure Mode</th>
                    <th>% of Failures</th>
                    <th>Diagnostic ID</th>
                    <th>Recommended Action</th>
                </tr>
            </thead>
            <tbody id="failureTableBody">
                <!-- Generated by JavaScript -->
            </tbody>
        </table>
    </div>

    <!-- Improvement Priority Matrix -->
    <div class="table-section" style="margin-top: 30px;">
        <h2>üéØ Improvement Priority Matrix</h2>
        <p style="color: #666; font-size: 13px; margin-bottom: 20px;">
            Modules ranked by failure impact and fix complexity. Focus on high-impact, low-complexity fixes first.
        </p>
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;" id="priorityMatrix">
            <!-- Generated by JavaScript -->
        </div>
    </div>

    <script>
        // Module data with match rates
        // Exact: PASS - correct, Model Correct
        // Semantic: PASS with variation, PASS with valid alternative, Valid Difference
        // Mismatch: All FAIL categories
        // Data source: full_evaluation_spreadsheet_20260114_134323.csv (unique Input Data per module)
        // Exact Match = "Model Correct", Semantic Match = "Valid Difference", Mismatch = "Prompt Issue" + "Model Issue"
        // Total = unique Input Data samples per module (actual samples evaluated)
        const moduleData = [
            { module: "M01", exact: 0, semantic: 7, mismatch: 3, total: 10 },
            { module: "M01a", exact: 5, semantic: 4, mismatch: 1, total: 10 },
            { module: "M01b", exact: 9, semantic: 0, mismatch: 1, total: 10 },
            { module: "M02", exact: 16, semantic: 0, mismatch: 4, total: 20 },
            { module: "M03", exact: 4, semantic: 0, mismatch: 6, total: 10 },
            { module: "M04", exact: 8, semantic: 4, mismatch: 8, total: 20 },
            { module: "M05", exact: 17, semantic: 1, mismatch: 2, total: 20 },
            { module: "M06", exact: 5, semantic: 1, mismatch: 4, total: 10 },
            { module: "M07", exact: 6, semantic: 0, mismatch: 4, total: 10 },
            { module: "M08", exact: 0, semantic: 4, mismatch: 6, total: 10 },
            { module: "M09", exact: 8, semantic: 0, mismatch: 2, total: 10 },
            { module: "M10", exact: 0, semantic: 1, mismatch: 9, total: 10 },
            { module: "M11", exact: 3, semantic: 1, mismatch: 6, total: 10 },
            { module: "M12", exact: 0, semantic: 13, mismatch: 7, total: 20 },
            { module: "M12b", exact: 0, semantic: 19, mismatch: 1, total: 20 },
            { module: "M13", exact: 17, semantic: 0, mismatch: 3, total: 20 },
            { module: "M14", exact: 17, semantic: 1, mismatch: 2, total: 20 },
            { module: "M15", exact: 2, semantic: 7, mismatch: 11, total: 20 },
            { module: "M16", exact: 15, semantic: 2, mismatch: 3, total: 20 }
        ];

        // Calculate totals
        const totals = moduleData.reduce((acc, m) => {
            acc.exact += m.exact;
            acc.semantic += m.semantic;
            acc.mismatch += m.mismatch;
            acc.total += m.total;
            return acc;
        }, { exact: 0, semantic: 0, mismatch: 0, total: 0 });

        // Render summary cards
        function renderSummary() {
            const summaryRow = document.getElementById('summaryRow');
            summaryRow.innerHTML = `
                <div class="summary-card">
                    <div class="label">Exact Match</div>
                    <div class="value exact">${((totals.exact / totals.total) * 100).toFixed(1)}%</div>
                    <div class="count">${totals.exact} of ${totals.total}</div>
                </div>
                <div class="summary-card">
                    <div class="label">Semantic Match</div>
                    <div class="value semantic">${((totals.semantic / totals.total) * 100).toFixed(1)}%</div>
                    <div class="count">${totals.semantic} of ${totals.total}</div>
                </div>
                <div class="summary-card">
                    <div class="label">Mismatch</div>
                    <div class="value mismatch">${((totals.mismatch / totals.total) * 100).toFixed(1)}%</div>
                    <div class="count">${totals.mismatch} of ${totals.total}</div>
                </div>
                <div class="summary-card">
                    <div class="label">Total Input Samples</div>
                    <div class="value total">${totals.total}</div>
                    <div class="count">across ${moduleData.length} modules</div>
                </div>
            `;
        }

        // Render chart
        function renderChart() {
            const ctx = document.getElementById('matchRateChart').getContext('2d');

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: moduleData.map(m => m.module),
                    datasets: [
                        {
                            label: 'Exact Match',
                            data: moduleData.map(m => (m.exact / m.total) * 100),
                            backgroundColor: '#27ae60',
                            borderRadius: 2
                        },
                        {
                            label: 'Semantic Match',
                            data: moduleData.map(m => (m.semantic / m.total) * 100),
                            backgroundColor: '#3498db',
                            borderRadius: 2
                        },
                        {
                            label: 'Mismatch',
                            data: moduleData.map(m => (m.mismatch / m.total) * 100),
                            backgroundColor: '#e74c3c',
                            borderRadius: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            stacked: true,
                            grid: { display: false }
                        },
                        y: {
                            stacked: true,
                            max: 100,
                            ticks: {
                                callback: value => value + '%'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.raw.toFixed(1) + '%';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Render table
        let currentSort = { column: 'module', direction: 'asc' };

        function renderTable() {
            const tbody = document.getElementById('tableBody');

            // Sort data
            const sortedData = [...moduleData].sort((a, b) => {
                let aVal, bVal;

                switch (currentSort.column) {
                    case 'module':
                        aVal = a.module;
                        bVal = b.module;
                        break;
                    case 'exact':
                        aVal = a.exact / a.total;
                        bVal = b.exact / b.total;
                        break;
                    case 'semantic':
                        aVal = a.semantic / a.total;
                        bVal = b.semantic / b.total;
                        break;
                    case 'mismatch':
                        aVal = a.mismatch / a.total;
                        bVal = b.mismatch / b.total;
                        break;
                    case 'total':
                        aVal = a.total;
                        bVal = b.total;
                        break;
                }

                if (currentSort.direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });

            tbody.innerHTML = sortedData.map(m => {
                const exactPct = (m.exact / m.total) * 100;
                const semanticPct = (m.semantic / m.total) * 100;
                const mismatchPct = (m.mismatch / m.total) * 100;

                return `
                    <tr>
                        <td class="module-name">${m.module}</td>
                        <td class="bar-cell">
                            <div class="stacked-bar">
                                ${exactPct > 0 ? `<div class="bar-segment exact" style="width: ${exactPct}%">${exactPct >= 10 ? Math.round(exactPct) + '%' : ''}</div>` : ''}
                                ${semanticPct > 0 ? `<div class="bar-segment semantic" style="width: ${semanticPct}%">${semanticPct >= 10 ? Math.round(semanticPct) + '%' : ''}</div>` : ''}
                                ${mismatchPct > 0 ? `<div class="bar-segment mismatch" style="width: ${mismatchPct}%">${mismatchPct >= 10 ? Math.round(mismatchPct) + '%' : ''}</div>` : ''}
                            </div>
                        </td>
                        <td class="rate-cell exact">${exactPct.toFixed(0)}%</td>
                        <td class="rate-cell semantic">${semanticPct.toFixed(0)}%</td>
                        <td class="rate-cell mismatch">${mismatchPct.toFixed(0)}%</td>
                        <td class="total-cell">${m.total}</td>
                    </tr>
                `;
            }).join('');

            // Update sort indicators
            document.querySelectorAll('th.sortable').forEach(th => {
                th.classList.remove('sorted-asc', 'sorted-desc');
                if (th.dataset.sort === currentSort.column) {
                    th.classList.add(currentSort.direction === 'asc' ? 'sorted-asc' : 'sorted-desc');
                }
            });
        }

        // Sort click handler
        document.querySelectorAll('th.sortable').forEach(th => {
            th.addEventListener('click', () => {
                const column = th.dataset.sort;
                if (currentSort.column === column) {
                    currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                } else {
                    currentSort.column = column;
                    currentSort.direction = 'desc';
                }
                renderTable();
            });
        });

        // =====================================================
        // DIAGNOSTIC DATA - Failure Root Cause Analysis
        // =====================================================

        // Semantic Mismatch breakdown (65 total)
        const semanticMismatchData = {
            labels: ['Synonym Usage', 'Granularity Difference', 'Wording Variation', 'Format Difference'],
            data: [28, 18, 12, 7],  // 43%, 28%, 18%, 11%
            colors: ['#5dade2', '#85c1e9', '#aed6f1', '#d6eaf8'],
            descriptions: [
                'Different word, same meaning (earbuds vs earphones)',
                'More/less specific than expected',
                'Different phrasing, same intent',
                'Case, order, spacing differences'
            ]
        };

        // Mismatch breakdown (83 total)
        const mismatchData = {
            labels: ['Logic Error', 'Over-Constrained', 'Wrong Classification', 'Feature as Type', 'Extraction Miss', 'Format Error'],
            data: [24, 18, 15, 12, 9, 5],  // 29%, 22%, 18%, 14%, 11%, 6%
            colors: ['#e74c3c', '#ec7063', '#f1948a', '#f5b7b1', '#fadbd8', '#fdedec'],
            descriptions: [
                'Wrong decision path in classification',
                'Too many hard constraints (M11)',
                'Wrong R/S/C/N label (M12-M16)',
                'Features in taxonomy instead of types (M06)',
                'Missed data from input',
                'Structural/JSON issues'
            ]
        };

        // Module-specific failure patterns
        const moduleFailures = [
            { module: 'M10', mode: 'Feature List Instead of Function', pct: 90, diagId: 'DIAG_M10_feature_list', action: 'Enforce [VERB]+[NOUN] format in prompt' },
            { module: 'M11', mode: 'Soft Features as Hard Constraints', pct: 67, diagId: 'DIAG_M11_soft_as_hard', action: 'Clarify: most products have 0 constraints' },
            { module: 'M08', mode: 'Ranks Exceed Expected Range', pct: 60, diagId: 'DIAG_M08_ranks_assigned', action: 'Fixed: No max rank limit (v2.4)' },
            { module: 'M03', mode: 'Off-Category Competitors', pct: 50, diagId: 'DIAG_M03_off_category', action: 'Add category validation to prompt' },
            { module: 'M15', mode: 'Primary Use Overlap Miscalculation', pct: 55, diagId: 'DIAG_M15_overlap_miscalculation', action: 'Clarify 60% overlap threshold' },
            { module: 'M06', mode: 'Feature-Based Instead of Type-Based', pct: 40, diagId: 'DIAG_M06_feature_based', action: 'Emphasize WHAT product IS, not features' },
            { module: 'M04', mode: 'Case Sensitivity Issues', pct: 50, diagId: 'DIAG_M04_false_negative', action: 'Fixed: Case-insensitive matching (v2.4)' },
            { module: 'M12', mode: 'Reasoning-Label Mismatch', pct: 35, diagId: 'DIAG_classification_reasoning_mismatch', action: 'Enforce reasoning-label consistency' },
            { module: 'M07', mode: 'Missing Key Attributes', pct: 40, diagId: 'DIAG_extraction_miss', action: 'Field-by-field verification' },
            { module: 'M01', mode: 'Synonym/Variation Acceptable', pct: 70, diagId: 'DIAG_synonym_usage', action: 'Update expected to accept variations' }
        ];

        // Priority matrix data
        const priorityMatrix = [
            { module: 'M10', impact: 'High', complexity: 'Low', priority: 1, color: '#27ae60' },
            { module: 'M11', impact: 'High', complexity: 'Medium', priority: 2, color: '#27ae60' },
            { module: 'M03', impact: 'High', complexity: 'Medium', priority: 3, color: '#f39c12' },
            { module: 'M15', impact: 'High', complexity: 'High', priority: 4, color: '#f39c12' },
            { module: 'M06', impact: 'Medium', complexity: 'Low', priority: 5, color: '#3498db' },
            { module: 'M08', impact: 'Medium', complexity: 'Low', priority: 6, color: '#95a5a6', note: 'Fixed' },
            { module: 'M04', impact: 'Medium', complexity: 'Low', priority: 7, color: '#95a5a6', note: 'Fixed' },
            { module: 'M12', impact: 'Medium', complexity: 'Medium', priority: 8, color: '#3498db' }
        ];

        // Render Semantic Mismatch Pie Chart
        function renderSemanticPieChart() {
            const ctx = document.getElementById('semanticPieChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: semanticMismatchData.labels,
                    datasets: [{
                        data: semanticMismatchData.data,
                        backgroundColor: semanticMismatchData.colors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const pct = ((context.raw / total) * 100).toFixed(0);
                                    return `${context.label}: ${context.raw} (${pct}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Render legend
            const legendHtml = semanticMismatchData.labels.map((label, i) => {
                const total = semanticMismatchData.data.reduce((a, b) => a + b, 0);
                const pct = ((semanticMismatchData.data[i] / total) * 100).toFixed(0);
                return `
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-size: 12px;">
                        <div style="width: 14px; height: 14px; border-radius: 3px; background: ${semanticMismatchData.colors[i]};"></div>
                        <div style="flex: 1;">
                            <strong>${label}</strong> (${pct}%)
                            <div style="color: #888; font-size: 11px;">${semanticMismatchData.descriptions[i]}</div>
                        </div>
                    </div>
                `;
            }).join('');
            document.getElementById('semanticLegend').innerHTML = legendHtml;
        }

        // Render Mismatch Pie Chart
        function renderMismatchPieChart() {
            const ctx = document.getElementById('mismatchPieChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: mismatchData.labels,
                    datasets: [{
                        data: mismatchData.data,
                        backgroundColor: mismatchData.colors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const pct = ((context.raw / total) * 100).toFixed(0);
                                    return `${context.label}: ${context.raw} (${pct}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Render legend
            const legendHtml = mismatchData.labels.map((label, i) => {
                const total = mismatchData.data.reduce((a, b) => a + b, 0);
                const pct = ((mismatchData.data[i] / total) * 100).toFixed(0);
                return `
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px; font-size: 12px;">
                        <div style="width: 14px; height: 14px; border-radius: 3px; background: ${mismatchData.colors[i]};"></div>
                        <div style="flex: 1;">
                            <strong>${label}</strong> (${pct}%)
                            <div style="color: #888; font-size: 11px;">${mismatchData.descriptions[i]}</div>
                        </div>
                    </div>
                `;
            }).join('');
            document.getElementById('mismatchLegend').innerHTML = legendHtml;
        }

        // Render Module Failure Table
        function renderFailureTable() {
            const tbody = document.getElementById('failureTableBody');
            tbody.innerHTML = moduleFailures.map(f => {
                const isFixed = f.action.includes('Fixed');
                return `
                    <tr style="${isFixed ? 'background: #f0fff0;' : ''}">
                        <td class="module-name">${f.module}</td>
                        <td>${f.mode}</td>
                        <td style="text-align: center; font-weight: 600; color: ${f.pct >= 50 ? '#e74c3c' : '#f39c12'};">${f.pct}%</td>
                        <td style="font-family: monospace; font-size: 11px; color: #666;">${f.diagId}</td>
                        <td style="font-size: 12px; ${isFixed ? 'color: #27ae60; font-weight: 600;' : ''}">${f.action}</td>
                    </tr>
                `;
            }).join('');
        }

        // Render Priority Matrix
        function renderPriorityMatrix() {
            const container = document.getElementById('priorityMatrix');
            container.innerHTML = priorityMatrix.map(p => {
                const isFixed = p.note === 'Fixed';
                return `
                    <div style="
                        background: ${isFixed ? '#f0f0f0' : 'white'};
                        border-radius: 10px;
                        padding: 15px;
                        border-left: 4px solid ${p.color};
                        ${isFixed ? 'opacity: 0.7;' : ''}
                    ">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <span style="font-weight: 700; font-size: 16px;">${p.module}</span>
                            <span style="
                                background: ${p.color};
                                color: white;
                                padding: 2px 8px;
                                border-radius: 10px;
                                font-size: 11px;
                                font-weight: 600;
                            ">${isFixed ? 'FIXED' : '#' + p.priority}</span>
                        </div>
                        <div style="font-size: 11px; color: #666;">
                            <div>Impact: <strong>${p.impact}</strong></div>
                            <div>Complexity: <strong>${p.complexity}</strong></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Initialize
        renderSummary();
        renderChart();
        renderTable();
        renderSemanticPieChart();
        renderMismatchPieChart();
        renderFailureTable();
        renderPriorityMatrix();
    </script>
</body>
</html>
