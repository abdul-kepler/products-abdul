<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module Evaluation Analysis Dashboard - Experiment V2</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background-color: #f5f7fa;
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 240px;
            background: linear-gradient(180deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 15px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 10px;
        }

        .sidebar-header h1 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 11px;
            opacity: 0.7;
        }

        .dashboard-info {
            margin: 0 15px 15px;
            padding: 12px;
            background: rgba(78, 205, 196, 0.15);
            border-radius: 8px;
            border-left: 3px solid #4ecdc4;
        }

        .dashboard-info h4 {
            font-size: 11px;
            text-transform: uppercase;
            color: #4ecdc4;
            margin-bottom: 6px;
        }

        .dashboard-info p {
            font-size: 10px;
            line-height: 1.5;
            opacity: 0.9;
        }

        .menu-section {
            margin: 15px 0;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .menu-section-title {
            padding: 0 15px;
            font-size: 10px;
            text-transform: uppercase;
            color: rgba(255,255,255,0.5);
            margin-bottom: 8px;
            letter-spacing: 1px;
        }

        .module-list {
            list-style: none;
        }

        .module-item {
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .module-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .module-item.active {
            background: rgba(255,255,255,0.15);
            border-left-color: #4ecdc4;
        }

        .module-item .module-name {
            font-size: 13px;
            font-weight: 500;
        }

        .module-item .module-rate {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
        }

        .rate-critical { background: #ff6b6b; color: white; }
        .rate-warning { background: #feca57; color: #333; }
        .rate-good { background: #4ecdc4; color: white; }
        .rate-excellent { background: #26de81; color: white; }

        .suggestions-item {
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            background: rgba(255, 107, 107, 0.1);
        }

        .suggestions-item:hover {
            background: rgba(255, 107, 107, 0.2);
        }

        .suggestions-item.active {
            background: rgba(255, 107, 107, 0.25);
            border-left-color: #ff6b6b;
        }

        .suggestions-item .icon {
            font-size: 16px;
        }

        .suggestions-item .text {
            font-size: 13px;
            font-weight: 500;
        }

        .suggestions-item .badge {
            margin-left: auto;
            background: #ff6b6b;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            margin-left: 240px;
            padding: 25px;
            flex: 1;
            max-width: calc(100% - 240px);
        }

        .module-header {
            margin-bottom: 25px;
        }

        .module-header h2 {
            font-size: 24px;
            color: #1a1a2e;
            margin-bottom: 5px;
        }

        .module-header .description {
            color: #666;
            font-size: 13px;
        }

        /* Stats Row */
        .stats-row {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            min-width: 120px;
        }

        .stat-card .label {
            font-size: 11px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 5px;
        }

        .stat-card .value {
            font-size: 24px;
            font-weight: 700;
            color: #1a1a2e;
        }

        .stat-card .value.pass { color: #26de81; }
        .stat-card .value.fail { color: #ff6b6b; }
        .stat-card .value.critical { color: #c0392b; }
        .stat-card .value.high { color: #e74c3c; }
        .stat-card .value.medium { color: #f39c12; }
        .stat-card .value.low { color: #27ae60; }

        /* Main Layout - Chart + Table side by side */
        .analysis-section {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .chart-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .chart-card h3 {
            font-size: 14px;
            color: #1a1a2e;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .chart-container {
            position: relative;
            height: 280px;
        }

        /* Analysis Table */
        .table-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            overflow-x: auto;
        }

        .table-card h3 {
            font-size: 14px;
            color: #1a1a2e;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }

        th {
            padding: 10px 8px;
            text-align: left;
            background: #f8f9fa;
            font-size: 11px;
            text-transform: uppercase;
            color: #666;
            font-weight: 600;
            white-space: nowrap;
        }

        td {
            padding: 10px 8px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
        }

        .issue-type-cell {
            font-weight: 600;
            white-space: nowrap;
        }

        .issue-type-cell.prompt { color: #d68910; }
        .issue-type-cell.model { color: #c0392b; }
        .issue-type-cell.valid { color: #27ae60; }
        .issue-type-cell.correct { color: #27ae60; }
        .issue-type-cell.judge { color: #8e44ad; }

        .analysis-summary-cell {
            font-weight: 500;
            color: #333;
        }

        .specific-issue-cell {
            color: #666;
            max-width: 200px;
        }

        .output-cell {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 10px;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            max-width: 250px;
            max-height: 80px;
            overflow: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        /* Fixed Section */
        .fixed-section {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .fixed-section h3 {
            color: #155724;
            font-size: 14px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .fixed-section h3::before {
            content: "‚úì";
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: #155724;
            color: white;
            border-radius: 50%;
            font-size: 12px;
        }

        .fixed-item {
            background: white;
            border-radius: 6px;
            padding: 10px 12px;
            margin-bottom: 8px;
            font-size: 13px;
            color: #333;
        }

        .fixed-item:last-child {
            margin-bottom: 0;
        }

        /* Recommendations Section */
        .recommendations-section {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
            border-radius: 10px;
            padding: 20px;
        }

        .recommendations-section h3 {
            color: #856404;
            font-size: 14px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .recommendations-section h3::before {
            content: "!";
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: #856404;
            color: white;
            border-radius: 50%;
            font-size: 12px;
            font-weight: bold;
        }

        .recommendation-item {
            background: white;
            border-radius: 6px;
            padding: 10px 12px;
            margin-bottom: 8px;
            font-size: 13px;
            color: #333;
        }

        .recommendation-item:last-child {
            margin-bottom: 0;
        }

        /* Legend */
        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: #666;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        /* Suggestions Page Styles */
        .suggestions-content {
            max-width: 1200px;
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-tab {
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s ease;
            background: white;
            color: #666;
            box-shadow: 0 2px 4px rgba(0,0,0,0.06);
        }

        .filter-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .filter-tab.active {
            background: #1a1a2e;
            color: white;
        }

        .filter-tab.critical.active { background: #c0392b; }
        .filter-tab.high.active { background: #e74c3c; }
        .filter-tab.medium.active { background: #f39c12; }
        .filter-tab.low.active { background: #27ae60; }

        .criticality-section {
            margin-bottom: 30px;
        }

        .criticality-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid;
        }

        .criticality-header.critical { border-color: #c0392b; }
        .criticality-header.high { border-color: #e74c3c; }
        .criticality-header.medium { border-color: #f39c12; }
        .criticality-header.low { border-color: #27ae60; }

        .criticality-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            color: white;
        }

        .criticality-badge.critical { background: #c0392b; }
        .criticality-badge.high { background: #e74c3c; }
        .criticality-badge.medium { background: #f39c12; }
        .criticality-badge.low { background: #27ae60; }

        .criticality-title {
            font-size: 18px;
            color: #1a1a2e;
        }

        .criticality-count {
            font-size: 13px;
            color: #888;
            margin-left: auto;
        }

        .suggestion-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            border-left: 4px solid;
        }

        .suggestion-card.critical { border-left-color: #c0392b; }
        .suggestion-card.high { border-left-color: #e74c3c; }
        .suggestion-card.medium { border-left-color: #f39c12; }
        .suggestion-card.low { border-left-color: #27ae60; }

        .suggestion-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .module-badge {
            background: #1a1a2e;
            color: white;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }

        .issue-type-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .issue-type-badge.prompt { background: #fff3cd; color: #856404; }
        .issue-type-badge.model { background: #f8d7da; color: #721c24; }

        .pass-rate-badge {
            margin-left: auto;
            font-size: 12px;
            color: #888;
        }

        .suggestion-body {
            display: grid;
            gap: 15px;
        }

        .issue-description {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .issue-description h4 {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .issue-description p {
            font-size: 14px;
            color: #333;
            line-height: 1.5;
        }

        .output-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .output-box {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
        }

        .output-box.expected {
            border-left: 3px solid #27ae60;
        }

        .output-box.actual {
            border-left: 3px solid #e74c3c;
        }

        .output-box h5 {
            font-size: 10px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .output-box pre {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 11px;
            color: #333;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 100px;
            overflow-y: auto;
        }

        .detailed-suggestion {
            background: linear-gradient(135deg, #e8f4fc 0%, #d6eaf8 100%);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .detailed-suggestion h4 {
            font-size: 12px;
            color: #2980b9;
            text-transform: uppercase;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .detailed-suggestion h4::before {
            content: "üí°";
        }

        .detailed-suggestion .suggestion-text {
            font-size: 13px;
            color: #333;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .detailed-suggestion .prompt-change {
            background: white;
            padding: 10px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 11px;
            color: #155724;
            margin-top: 10px;
        }

        .detailed-suggestion .prompt-change strong {
            color: #c0392b;
        }

        .impact-badge {
            display: inline-block;
            background: #d4edda;
            color: #155724;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 10px;
        }

        @media (max-width: 1200px) {
            .analysis-section {
                grid-template-columns: 1fr;
            }
            .output-comparison {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <h1>Module Analysis</h1>
            <p>KW Classification Pipeline - Experiment V2</p>
        </div>
        <div class="dashboard-info">
            <h4>What This Shows</h4>
            <p><strong>LLM Judge Pass/Fail Decisions</strong><br>
            Each module is evaluated by an LLM Judge against specific rubrics. This dashboard shows the pass rate for each rubric, categorized by issue type (Prompt Issue, Model Issue, Judge Issue, etc.).</p>
        </div>

        <div class="menu-section">
            <div class="menu-section-title">Actions</div>
            <div class="suggestions-item" id="suggestionsMenuItem" onclick="showSuggestions()">
                <span class="icon">‚ö†Ô∏è</span>
                <span class="text">Improvement Suggestions</span>
                <span class="badge" id="totalIssuesBadge">11</span>
            </div>
        </div>

        <div class="menu-section">
            <div class="menu-section-title">Modules (by Pass Rate)</div>
            <ul class="module-list" id="moduleList">
            <li class="module-item" data-module="M01" onclick="selectModule('M01')">
                <span class="module-name">M01</span>
                <span class="module-rate rate-warning">40%</span>
            </li>
        
            <li class="module-item" data-module="M04" onclick="selectModule('M04')">
                <span class="module-name">M04</span>
                <span class="module-rate rate-good">61%</span>
            </li>
        
            <li class="module-item" data-module="M01A" onclick="selectModule('M01A')">
                <span class="module-name">M01A</span>
                <span class="module-rate rate-good">75%</span>
            </li>
        
            <li class="module-item" data-module="M01B" onclick="selectModule('M01B')">
                <span class="module-name">M01B</span>
                <span class="module-rate rate-excellent">95%</span>
            </li>
        
            <li class="module-item" data-module="M02" onclick="selectModule('M02')">
                <span class="module-name">M02</span>
                <span class="module-rate rate-excellent">99%</span>
            </li>
        </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <!-- Generated by JavaScript -->
    </main>

    <script>
        // Module Data with Analysis Summary breakdown and examples
        const moduleData = {
            "M01": {
                        "name": "M01 - Extract Own Brand Entities",
                        "description": "Extracts brand name and variations from product listing",
                        "total": 25,
                        "pass": 10,
                        "fail": 15,
                        "passRate": 40,
                        "analysisSummary": {
                                    "PASS - correct": 10,
                                    "FAIL - amazon test applied": 5,
                                    "FAIL - no duplicate entities": 2,
                                    "FAIL - brand extracted": 4,
                                    "FAIL - no hallucinated brand": 3,
                                    "FAIL - no product words in brand": 1
                        },
                        "analysisTable": [
                                    {
                                                "issueType": "Model Correct",
                                                "analysisSummary": "PASS - correct (10)",
                                                "specificIssue": "All evaluations passed for this rubric",
                                                "expectedOutput": "-",
                                                "actualOutput": "-"
                                    },
                                    {
                                                "issueType": "Prompt Issue",
                                                "analysisSummary": "FAIL - amazon test applied (5)",
                                                "specificIssue": "Model includes entities that fail the Amazon Test (like 'Vibe Beam' from 'JBL Vibe Beam'). The prompt instructs to apply Amazon Test but lacks explicit rules for: (1) When sub-brand components pass vs fail Amazon Test, (2) How to validate typos of sub-brands, (3) Whether to include the combined form (e.g., 'JBL Vibe Beam').",
                                                "expectedOutput": "{\"brand_entities\": [\"JBL\", \"JBL Vibe\", \"Vibe Beam\", \"JLB\", \"JB L\", \"JBL VibeBeam\"]}",
                                                "actualOutput": "{\"brand_entities\": [\"JBL\", \"jbl\", \"JLB\", \"J B L\", \"JBLl\", \"Vibe Beam\", \"VibeBeam\", \"Vibe Beem\", \"Vibe Beem\", \"Vibe Beamn\"]}"
                                    },
                                    {
                                                "issueType": "Prompt Issue",
                                                "analysisSummary": "FAIL - brand extracted (4)",
                                                "specificIssue": "Model generates excessive duplicate case variants and insufficient phonetic typos. The typo rules lack clear priority ordering (most common typos first) and the model over-generates simple case changes while under-generating keyboard errors and phonetic misspellings.",
                                                "expectedOutput": "{\"brand_entities\": [\"Owala\", \"Owala FreeSip\", \"FreeSip\", \"Owalaa\", \"Owallah\", \"Ohwala\", \"O wala\", \"O-wala\", \"Free Sip\", \"Freesip\"]}",
                                                "actualOutput": "{\"brand_entities\": [\"Owala\", \"owala\", \"Owalaa\", \"Owla\", \"Oawla\", \"FreeSip\", \"freesip\", \"FreeSipp\", \"FreeSippp\", \"FreeSipz\"]}"
                                    },
                                    {
                                                "issueType": "Prompt Issue",
                                                "analysisSummary": "FAIL - no duplicate entities (2)",
                                                "specificIssue": "Model outputs duplicate strings. This is a PROMPT ISSUE - deduplication instructions need explicit step-by-step checking. Tested 15 prompt iterations achieving 36%->40% improvement with rule changes only.",
                                                "expectedOutput": "{\"brand_entities\": [\"Pioneer Camp\", \"PioneerCamp\", \"Pionner Camp\", \"Pioneer Camps\", \"Pioner Camp\", \"Pioneer Kamp\"]}",
                                                "actualOutput": "{\"brand_entities\": [\"Pioneer Camp\", \"pioneer camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\"]}"
                                    },
                                    {
                                                "issueType": "Model Issue",
                                                "analysisSummary": "FAIL - no hallucinated brand (3)",
                                                "specificIssue": "This is a TRUE MODEL ISSUE - the model generates typos like 'Cisilyy' (double-y ending) that don't follow valid typo patterns and aren't derivable from input. The issue persists even with explicit anti-hallucination instructions because LLMs have a tendency to generate creative variations rather than strictly derive from input.",
                                                "expectedOutput": "{\"brand_entities\": [\"Cisily\", \"CISILY\", \"Cisly\", \"Cisiliy\", \"Cisely\", \"Sisily\", \"Cis ily\"]}",
                                                "actualOutput": "{\"brand_entities\": [\"Cisily\", \"cisily\", \"Cisiliy\", \"Cisly\", \"Cisilyy\"]}"
                                    },
                                    {
                                                "issueType": "Improved",
                                                "analysisSummary": "FAIL - no product words in brand (1)",
                                                "specificIssue": "gpt-4o correctly identifies trademarked product lines. Remaining failures are actual model errors where generic product words are included.",
                                                "expectedOutput": "{\"brand_entities\": [\"Pioneer Camp\", \"PioneerCamp\", \"Pionner Camp\", \"Pioneer Camps\", \"Pioner Camp\"]}",
                                                "actualOutput": "{\"brand_entities\": [\"Pioneer Camp\", \"pioneer camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\"]}"
                                    }
                        ],
                        "fixed": [],
                        "recommendations": []
            },
            "M01A": {
                        "name": "M01a - Extract Brand Variations",
                        "description": "Generates typo/case variations of brand name",
                        "total": 20,
                        "pass": 15,
                        "fail": 5,
                        "passRate": 75,
                        "analysisSummary": {
                                    "PASS - correct": 15,
                                    "FAIL - no unrelated terms": 5
                        },
                        "analysisTable": [
                                    {
                                                "issueType": "Model Correct",
                                                "analysisSummary": "PASS - correct (15)",
                                                "specificIssue": "All evaluations passed for this rubric",
                                                "expectedOutput": "-",
                                                "actualOutput": "-"
                                    },
                                    {
                                                "issueType": "Judge Issue",
                                                "analysisSummary": "FAIL - no unrelated terms (5)",
                                                "specificIssue": "Failures are for 'Rx Crush' where typos like 'Rz Crush' (z is adjacent to x on QWERTY keyboard) are being marked as 'not plausible references'. These ARE valid keyboard typos that real users make.",
                                                "expectedOutput": "{\"variations\": [\"Rx Crush\", \"rx crush\", \"RxCrush\", \"Rz Crush\", \"Rxc Rush\"]}",
                                                "actualOutput": "{\"variations\": [\"Rx Crush\", \"rx crush\", \"RxCrush\", \"Rz Crush\", \"Rxc Rush\"]}"
                                    }
                        ],
                        "fixed": [],
                        "recommendations": []
            },
            "M01B": {
                        "name": "M01b - Extract Brand Related Terms",
                        "description": "Extracts sub-brands, product lines, manufacturer",
                        "total": 60,
                        "pass": 57,
                        "fail": 3,
                        "passRate": 95,
                        "analysisSummary": {
                                    "PASS - correct": 57,
                                    "FAIL - sub-brands identified": 2,
                                    "FAIL - manufacturer null when same as brand": 1
                        },
                        "analysisTable": [
                                    {
                                                "issueType": "Model Correct",
                                                "analysisSummary": "PASS - correct (57)",
                                                "specificIssue": "All evaluations passed for this rubric",
                                                "expectedOutput": "-",
                                                "actualOutput": "-"
                                    },
                                    {
                                                "issueType": "Model Issue",
                                                "analysisSummary": "FAIL - manufacturer null when same as brand (1)",
                                                "specificIssue": "The rubric requires the manufacturer to return null only when it matches or contains the brand name. In this case, the manufacturer 'Sachsen-Us' does not match or contain the brand name 'WEBACOO', so it should not return null. The module output incorrectly returned null, failing to provide the manufacturer object when it is genuinely different from the brand name.",
                                                "expectedOutput": "{\"manufacturer\": {\"name\": \"Sachsen-Us\", \"searchable\": false, \"short\": \"Sachsen-Us\"}, \"searchable_standards\": [], \"sub_brands\": []}",
                                                "actualOutput": "{\"manufacturer\": null, \"searchable_standards\": [], \"sub_brands\": []}"
                                    },
                                    {
                                                "issueType": "Model Issue",
                                                "analysisSummary": "FAIL - sub-brands identified (2)",
                                                "specificIssue": "The rubric requires identifying major sub-brands and product lines. The input data mentions 'Kitchen Aid Ribbed Soft Silicone' as a specific product line, which was not captured in the module output. Therefore, the output fails to meet the PASS conditions as it missed an obvious sub-brand present in the listing.",
                                                "expectedOutput": "{\"manufacturer\": {\"name\": \"Town & Country Living\", \"searchable\": false, \"short\": \"Town & Country\"}, \"searchable_standards\": [], \"sub_brands\": []}",
                                                "actualOutput": "{\"manufacturer\": {\"name\": \"Town & Country Living\", \"searchable\": false, \"short\": \"Town & Country\"}, \"searchable_standards\": [], \"sub_brands\": []}"
                                    }
                        ],
                        "fixed": [],
                        "recommendations": []
            },
            "M02": {
                        "name": "M02 - Classify Own Brand Keywords",
                        "description": "Classifies keyword as OB (Own Brand) or passes through",
                        "total": 105,
                        "pass": 104,
                        "fail": 1,
                        "passRate": 99,
                        "analysisSummary": {
                                    "PASS - correct": 104,
                                    "FAIL - no similar brand confusion": 1
                        },
                        "analysisTable": [
                                    {
                                                "issueType": "Model Correct",
                                                "analysisSummary": "PASS - correct (104)",
                                                "specificIssue": "All evaluations passed for this rubric",
                                                "expectedOutput": "-",
                                                "actualOutput": "-"
                                    },
                                    {
                                                "issueType": "Model Issue",
                                                "analysisSummary": "FAIL - no similar brand confusion (1)",
                                                "specificIssue": "The module output incorrectly states that 'skullcandy' was verified against itself, which is nonsensical. The task was to verify against the provided brand entities, not the keyword itself. The reasoning does not demonstrate character-by-character verification against the brand entities, nor does it address potential similar-sounding brand confusion. Therefore, it does not meet the PASS conditions.",
                                                "expectedOutput": "{\"branding_scope_1\": null}",
                                                "actualOutput": "{\"branding_scope_1\": null, \"confidence\": 0.99, \"reasoning\": \"Verified: 'skullcandy' (s-k-u-l-l-c-a-n-d-y) not found in 'skullcandy'. No brand entity found.\", \"output_ob\": \"\"}"
                                    }
                        ],
                        "fixed": [],
                        "recommendations": []
            },
            "M04": {
                        "name": "M04 - Classify Competitor Brand Keywords",
                        "description": "Classifies keyword as CB (Competitor Brand) or passes through",
                        "total": 80,
                        "pass": 49,
                        "fail": 31,
                        "passRate": 61,
                        "analysisSummary": {
                                    "PASS - correct": 49,
                                    "FAIL - case insensitive matching": 12,
                                    "FAIL - correct cb/null classification": 12,
                                    "FAIL - competitor correctly identified": 7
                        },
                        "analysisTable": [
                                    {
                                                "issueType": "Model Correct",
                                                "analysisSummary": "PASS - correct (49)",
                                                "specificIssue": "All evaluations passed for this rubric",
                                                "expectedOutput": "-",
                                                "actualOutput": "-"
                                    },
                                    {
                                                "issueType": "Mixed (Judge + Model)",
                                                "analysisSummary": "FAIL - case insensitive matching (12)",
                                                "specificIssue": "Two types of failures: (1) REAL: Model fails lowercase to uppercase brand match. (2) JUDGE: Model correctly matches case variants but judge fails because reasoning doesn't say 'case-insensitive'.",
                                                "expectedOutput": "{\"branding_scope_2\": \"CB\"} for keyword 'oven mitts oxo' (OXO is competitor)",
                                                "actualOutput": "{\"branding_scope_2\": \"\", \"reasoning\": \"'oxo' is not in the provided competitor_entities list\"}"
                                    },
                                    {
                                                "issueType": "Model Issue",
                                                "analysisSummary": "FAIL - competitor correctly identified (7)",
                                                "specificIssue": "The rubric requires that the matched_competitor field correctly identifies a competitor from the provided list if present in the keyword. The module output did not identify any competitor, stating that 'oven mitt' is generic, but it failed to recognize that 'blue q' could potentially be a competitor not listed in the provided entities. Therefore, the output does not meet the PASS conditions.",
                                                "expectedOutput": "{\"branding_scope_2\": \"CB\"}",
                                                "actualOutput": "{\"branding_scope_2\": \"\", \"reasoning\": \"Keyword contains 'oven mitt' which is generic and does not mention any competitor brand.\"}"
                                    },
                                    {
                                                "issueType": "Prompt Issue",
                                                "analysisSummary": "FAIL - correct cb/null classification (12)",
                                                "specificIssue": "Model misses competitor brand matches like 'oxo' -> 'OXO'. This is a PROMPT ISSUE - the prompt says 'Normalize the keyword' but doesn't explicitly say to normalize BOTH keyword AND competitor_entities list before comparison.",
                                                "expectedOutput": "{\"branding_scope_2\": \"CB\"} for keyword 'oxo oven mitts' (OXO is in competitor list)",
                                                "actualOutput": "{\"branding_scope_2\": \"\", \"reasoning\": \"Keyword contains 'oxo' which is not in the competitor_entities list\"}"
                                    }
                        ],
                        "fixed": [],
                        "recommendations": []
            }
};

        // Detailed improvement suggestions with prompt changes
        // ‚úÖ = VALIDATED through experiments, ‚è≥ = Pending validation
        const improvementSuggestions = [
            {
                        "module": "M01",
                        "rubric": "Amazon Test Applied",
                        "criticality": "Critical",
                        "passRate": 7.0,
                        "v3PassRate": 13.3,
                        "issueType": "Prompt Issue",
                        "analysisSummary": "Prompt Issue - Amazon Test instructions need explicit sub-brand rules",
                        "specificIssue": "Model includes entities that fail the Amazon Test (like 'Vibe Beam' from 'JBL Vibe Beam'). The prompt instructs to apply Amazon Test but lacks explicit rules for: (1) When sub-brand components pass vs fail Amazon Test, (2) How to validate typos of sub-brands, (3) Whether to include the combined form (e.g., 'JBL Vibe Beam').",
                        "expectedOutput": "{\"brand_entities\": [\"JBL\", \"JBL Vibe\", \"Vibe Beam\", \"JLB\", \"JB L\", \"JBL VibeBeam\"]}",
                        "actualOutput": "{\"brand_entities\": [\"JBL\", \"jbl\", \"JLB\", \"J B L\", \"JBLl\", \"Vibe Beam\", \"VibeBeam\", \"Vibe Beem\", \"Vibe Beem\", \"Vibe Beamn\"]}",
                        "detailedSuggestion": "Add explicit Sub-brand Output Rules section and Typo Validation Rule to the M01 prompt. The model needs step-by-step instructions for handling sub-brand combinations.",
                        "promptChange": "<div style=\"background:#fff3cd;color:#333;padding:10px;border-radius:5px;margin-bottom:10px;border:1px solid #ffc107;\"><span style=\"color:#856404;font-weight:bold;\">PROMPT ISSUE - Improvement Suggested</span><br>Expected Improvement: 40-60%</div><hr><strong>SUGGESTED CHANGE TO: prompts/modules/m01_extract_own_brand_entities.md</strong><hr><pre style=\"background:#ffebee;padding:10px;font-size:11px;border-left:4px solid #c62828;\"><strong>OLD (Current - Amazon Test Section):</strong>\n\n### The Amazon Test\nFor each word, ask: \"Can I search Amazon and buy a [word] as a standalone product?\"\n- [word] -> Yes, you can buy it -> PRODUCT WORD -> exclude\n- [Brand] -> No, it's a brand name -> BRAND ENTITY -> include\n- [SubBrand] -> No, it's a trademarked product line -> BRAND ENTITY -> include\n</pre><pre style=\"background:#e8f5e9;padding:10px;font-size:11px;border-left:4px solid #2e7d32;\"><strong>NEW (Suggested):</strong>\n\n### The Amazon Test\nFor each word, ask: \"Can I search Amazon and buy a [word] as a standalone product?\"\n- [word] -> Yes, you can buy it -> PRODUCT WORD -> exclude\n- [Brand] -> No, it's a brand name -> BRAND ENTITY -> include\n- [SubBrand] -> No, it's a trademarked product line -> BRAND ENTITY -> include\n\n### CRITICAL: Apply Amazon Test to EVERY word in multi-word entities\n\nWhen you have a sub-brand like \"[Brand] [SubBrand]\", you MUST test EACH word:\n\n1. Test \"[SubBrand]\" alone: Can you buy a \"[SubBrand]\" on Amazon?\n   - If \"[SubBrand]\" is a common word -> REMOVE the entire entity\n   - If \"[SubBrand]\" is ONLY used as this brand's trademark -> KEEP\n\n**Common words that FAIL the Amazon Test when used in sub-brands:**\n- beam, wave, pro, max, plus, ultra -> generic product modifiers\n- bass, sound, audio, noise -> audio/electronics terms\n- fresh, pure, clean, clear -> descriptive adjectives\n- sport, active, fit, flex -> lifestyle terms\n\n**Rule: If the last word of a sub-brand is a dictionary word with meaning outside this brand, EXCLUDE the entire sub-brand entity.**</pre>",
                        "impact": "Critical - Core rubric failing at 7%",
                        "validated": false,
                        "validationStatus": "SUGGESTED",
                        "expectedImprovement": "40-60%",
                        "experimentDate": "2026-01-16",
                        "experimentModel": "gpt-4o"
            },
            {
                        "module": "M01",
                        "rubric": "Brand Extracted",
                        "criticality": "High",
                        "passRate": 20.0,
                        "issueType": "Prompt Issue",
                        "analysisSummary": "Prompt Issue - Typo generation rules need priority ordering",
                        "specificIssue": "Model generates excessive duplicate case variants and insufficient phonetic typos. The typo rules lack clear priority ordering (most common typos first) and the model over-generates simple case changes while under-generating keyboard errors and phonetic misspellings.",
                        "expectedOutput": "{\"brand_entities\": [\"Owala\", \"Owala FreeSip\", \"FreeSip\", \"Owalaa\", \"Owallah\", \"Ohwala\", \"O wala\", \"O-wala\", \"Free Sip\", \"Freesip\"]}",
                        "actualOutput": "{\"brand_entities\": [\"Owala\", \"owala\", \"Owalaa\", \"Owla\", \"Oawla\", \"FreeSip\", \"freesip\", \"FreeSipp\", \"FreeSippp\", \"FreeSipz\"]}",
                        "detailedSuggestion": "Restructure typo generation section with priority-ordered typo types and explicit AVOID section to prevent over-generation of simple case variants.",
                        "promptChange": "<div style=\"background:#fff3cd;color:#333;padding:10px;border-radius:5px;margin-bottom:10px;border:1px solid #ffc107;\"><span style=\"color:#856404;font-weight:bold;\">PROMPT ISSUE - Improvement Suggested</span><br>Expected Improvement: 25-30%</div><hr><strong>SUGGESTED CHANGE TO: prompts/modules/m01_extract_own_brand_entities.md</strong><hr><pre style=\"background:#ffebee;padding:10px;font-size:11px;border-left:4px solid #c62828;\"><strong>OLD (Current - Typo Generation Section):</strong>\n\n### Step 2: Generate Typos (MANDATORY - 3-5 per brand)\n| Typo Type | How to Apply |\n|-----------|--------------|\n| Doubled letter | Double the last vowel or consonant |\n| Missing letter | Remove one letter |\n| Swapped letters | Swap adjacent letters |\n| Case variation | All lowercase |\n| With space | Add space in compound |</pre><pre style=\"background:#e8f5e9;padding:10px;font-size:11px;border-left:4px solid #2e7d32;\"><strong>NEW (Suggested):</strong>\n\n### Step 2: Generate Typos (MANDATORY - 4-6 UNIQUE per brand)\n\nGenerate DIVERSE misspellings. **Prioritize phonetic typos over case changes.**\n\n| Typo Type | Priority | How to Apply |\n|-----------|----------|---------------|\n| Missing letter | HIGH | Remove vowel/consonant: [Brand]->[Brnd] |\n| Swapped adjacent | HIGH | Swap 2 adjacent: [Brand]->[Barnd] |\n| Phonetic substitution | HIGH | Similar sound: 'y'->'ie', 'c'->'s' |\n| Doubled letter | MEDIUM | Double vowel/consonant: [Brand]->[Brannd] |\n| Wrong vowel | MEDIUM | Vowel confusion: a<->e, i<->y, o<->u |\n| Case variation | LOW | Only ONE lowercase per brand |\n| With space | LOW | For compounds only |\n\n**TYPO GENERATION RULES:**\n1. Generate EXACTLY 1 case variant (lowercase) - no more!\n2. Generate 3-5 DIFFERENT spelling/phonetic typos\n3. Each typo must be UNIQUE - check before adding\n4. Focus on mistakes real customers make when typing fast</pre>",
                        "impact": "High - Basic brand extraction failing",
                        "validated": false,
                        "validationStatus": "SUGGESTED",
                        "expectedImprovement": "25-30%",
                        "experimentDate": "2026-01-16",
                        "experimentModel": "gpt-4o"
            },
            {
                        "module": "M01",
                        "rubric": "No Hallucinated Brand",
                        "criticality": "High",
                        "passRate": 27.0,
                        "v3PassRate": 33.3,
                        "issueType": "Model Issue",
                        "analysisSummary": "Model Issue - LLM hallucinating brand names not in input",
                        "specificIssue": "This is a TRUE MODEL ISSUE - the model generates typos like 'Cisilyy' (double-y ending) that don't follow valid typo patterns and aren't derivable from input. The issue persists even with explicit anti-hallucination instructions because LLMs have a tendency to generate creative variations rather than strictly derive from input.",
                        "expectedOutput": "{\"brand_entities\": [\"Cisily\", \"CISILY\", \"Cisly\", \"Cisiliy\", \"Cisely\", \"Sisily\", \"Cis ily\"]}",
                        "actualOutput": "{\"brand_entities\": [\"Cisily\", \"cisily\", \"Cisiliy\", \"Cisly\", \"Cisilyy\"]}",
                        "detailedSuggestion": "This is a model limitation. Suggested mitigation (limited effectiveness): Add explicit constraints and validation rules, but expect only 10-25% improvement. Consider model change or fine-tuning for significant improvement.",
                        "promptChange": "<div style=\"background:#f8d7da;color:#333;padding:10px;border-radius:5px;margin-bottom:10px;border:1px solid #f5c6cb;\"><span style=\"color:#721c24;font-weight:bold;\">MODEL ISSUE - Limited Improvement Expected</span><br>Expected Improvement: 10-25% (true model limitation)</div><hr><strong>SUGGESTED CHANGE TO: prompts/modules/m01_extract_own_brand_entities.md</strong><hr><pre style=\"background:#ffebee;padding:10px;font-size:11px;border-left:4px solid #c62828;\"><strong>OLD (Current):</strong>\n\n### Typo Generation\nGenerate 3-5 typos per brand using:\n| Type | Example |\n|------|---------|  \n| Mechanical | [Brand] -> [Brandyy], [Bran] |</pre><pre style=\"background:#e8f5e9;padding:10px;font-size:11px;border-left:4px solid #2e7d32;\"><strong>NEW (Suggested - Mitigations):</strong>\n\n### Typo Generation (STRICT RULES)\n\n**CONSTRAINT: Each typo must be traceable to EXACTLY ONE edit operation.**\n\nValid single-edit operations:\n1. Double ONE existing letter: [Brand] -> [Braand]\n2. Drop ONE letter: [Brand] -> [Bran]\n3. Swap TWO adjacent letters: [Brand] -> [Barnd]\n4. Replace with keyboard-adjacent key: [Brand] -> [Brqnd] (a->q adjacent)\n\n**AVOID (Hallucination Patterns):**\n- Adding letters not adjacent on keyboard\n- Doubling ending letters not in original\n- Multiple simultaneous edits\n- Any output not derivable from brand_name field</pre><hr><div style=\"background:#fff3cd;padding:10px;border-radius:5px;margin-top:10px;\"><strong>Note:</strong> This is a model capability limitation. LLMs tend to generate creative variations. For >80% accuracy, consider:<br>- Switching to a constrained generation approach<br>- Using a validation layer post-generation<br>- Fine-tuning on correct typo patterns</div>",
                        "impact": "High - Model creating non-existent brands",
                        "validated": false,
                        "validationStatus": "MODEL_LIMITATION",
                        "expectedImprovement": "10-25%",
                        "experimentDate": "2026-01-16",
                        "experimentModel": "gpt-4o"
            },
            {
                        "module": "M01",
                        "rubric": "No Product Words in Brand",
                        "criticality": "Medium",
                        "passRate": 53.0,
                        "v3PassRate": 20.0,
                        "issueType": "Improved",
                        "analysisSummary": "IMPROVED from 20% to 53% with gpt-4o",
                        "specificIssue": "gpt-4o correctly identifies trademarked product lines. Remaining failures are actual model errors where generic product words are included.",
                        "expectedOutput": "{\"brand_entities\": [\"Pioneer Camp\", \"PioneerCamp\", \"Pionner Camp\", \"Pioneer Camps\", \"Pioner Camp\"]}",
                        "actualOutput": "{\"brand_entities\": [\"Pioneer Camp\", \"pioneer camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\"]}",
                        "detailedSuggestion": "The 33% improvement confirms V3 failures were judge errors. Remaining 47% failures are real model issues.",
                        "promptChange": "<div style=\"background:#d4edda;color:#333;padding:10px;border-radius:5px;margin-bottom:10px;border:1px solid #28a745;\"><span style=\"color:#155724;font-weight:bold;\">IMPROVED +33%</span></div>V3: 20% -> V4: 53%<br>Judge interpretation fixed by gpt-4o",
                        "impact": "Improved - gpt-4o fixed judge errors",
                        "validated": true,
                        "experimentDate": "2026-01-16",
                        "experimentModel": "gpt-4o"
            },
            {
                        "module": "M01",
                        "rubric": "No Duplicate Entities",
                        "criticality": "Medium",
                        "passRate": 60.0,
                        "v3PassRate": 20.0,
                        "issueType": "Prompt Issue",
                        "analysisSummary": "Prompt Issue - Deduplication rules need improvement",
                        "specificIssue": "Model outputs duplicate strings. This is a PROMPT ISSUE - deduplication instructions need explicit step-by-step checking. Tested 15 prompt iterations achieving 36%->40% improvement with rule changes only.",
                        "expectedOutput": "{\"brand_entities\": [\"Pioneer Camp\", \"PioneerCamp\", \"Pionner Camp\", \"Pioneer Camps\", \"Pioner Camp\", \"Pioneer Kamp\"]}",
                        "actualOutput": "{\"brand_entities\": [\"Pioneer Camp\", \"pioneer camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\", \"Pioneer Camp\"]}",
                        "detailedSuggestion": "SUGGESTED: Add stronger deduplication rules and multi-word brand templates to prompt.",
                        "promptChange": "<div style=\"background:#fff3cd;color:#333;padding:10px;border-radius:5px;margin-bottom:10px;border:1px solid #ffc107;\"><span style=\"color:#856404;font-weight:bold;\">PROMPT ISSUE - Improvement Suggested</span><br>Tested: 15 iterations | Baseline: 36% -> Best: 40% | Improvement: +4%</div><hr><strong>SUGGESTED CHANGE TO: prompts/modules/m01_extract_own_brand_entities.md</strong><hr><pre style=\"background:#ffebee;padding:10px;font-size:11px;border-left:4px solid #c62828;\"><strong>OLD:</strong>\n\nGenerate typos (MANDATORY - 3-5 per brand)</pre><pre style=\"background:#e8f5e9;padding:10px;font-size:11px;border-left:4px solid #2e7d32;\"><strong>NEW:</strong>\n\nGenerate typos (MANDATORY - 3-4 per brand)\nRULE: Each typo = EXACTLY 1 edit from original\n\nFor SINGLE-WORD brands:\n1. Lowercase: [Brand] -> [brand]\n2. Double last letter: [Brand] -> [Brandd]\n3. Drop one letter: [Brand] -> [Bran]\n4. Swap two letters: [Brand] -> [Brnad]\n\nFor MULTI-WORD brands:\n1. Lowercase all\n2. Double a letter in first word\n3. Double a letter in second word\n4. Remove space</pre>",
                        "impact": "Suggested - Requires user approval to apply",
                        "validated": false,
                        "validationStatus": "SUGGESTED",
                        "iterationData": {
                                    "totalIterations": 15,
                                    "progression": [
                                                36,
                                                40,
                                                40,
                                                20,
                                                40,
                                                40,
                                                20,
                                                60,
                                                40,
                                                80,
                                                80,
                                                80,
                                                100,
                                                100,
                                                100
                                    ],
                                    "bestWithoutDataSamples": 40,
                                    "note": "100% achieved by adding dataset samples (not allowed). Clean improvement is +4%"
                        },
                        "experimentDate": "2026-01-16",
                        "experimentModel": "gpt-4o-mini"
            },
            {
                        "module": "M01A",
                        "rubric": "No Unrelated Terms",
                        "criticality": "Low",
                        "passRate": 75.0,
                        "issueType": "Judge Issue",
                        "analysisSummary": "Judge Issue - Judge incorrectly failing valid keyboard typos",
                        "specificIssue": "Failures are for 'Rx Crush' where typos like 'Rz Crush' (z is adjacent to x on QWERTY keyboard) are being marked as 'not plausible references'. These ARE valid keyboard typos that real users make.",
                        "expectedOutput": "{\"variations\": [\"Rx Crush\", \"rx crush\", \"RxCrush\", \"Rz Crush\", \"Rxc Rush\"]}",
                        "actualOutput": "{\"variations\": [\"Rx Crush\", \"rx crush\", \"RxCrush\", \"Rz Crush\", \"Rxc Rush\"]}",
                        "detailedSuggestion": "This is a JUDGE ISSUE, not a model issue. The rubric should accept keyboard-adjacent typos (z near x, r near t, etc.) as valid brand references.",
                        "promptChange": "<div style=\"background:#17a2b8;color:#fff;padding:10px;border-radius:5px;margin-bottom:10px;border:1px solid #138496;\"><span style=\"font-weight:bold;\">JUDGE ISSUE - Rubric Update Needed</span></div><strong>Analysis:</strong> Failures are for keyboard-adjacent typos being marked invalid<br><br><strong>Failed Pattern:</strong><br>- Letter swapped with adjacent keyboard key (z/x, r/t)<br>- Spacing typos in multi-word brands<br>- Double keyboard errors<br><br><strong>These ARE valid keyboard typos</strong> that real Amazon shoppers make.<hr><strong>SUGGESTED RUBRIC FIX (not prompt fix):</strong><hr><pre style=\"background:#f5f5f5;padding:10px;font-size:11px;\">OLD RUBRIC:\nFAIL if output contains variations that are not plausible references to the brand\n\nNEW RUBRIC:\nFAIL if output contains variations that are not plausible references to the brand\n\nNOTE: Keyboard-adjacent typos ARE plausible:\n- z/x swap (adjacent keys)\n- r/t swap (adjacent keys)\n- spacing errors in multi-word brands</pre>",
                        "impact": "Low - Judge needs rubric update, not prompt change",
                        "validated": true,
                        "experimentDate": "2026-01-16",
                        "experimentModel": "gpt-4o"
            },
            {
                        "module": "M01A",
                        "rubric": "8-12 Variations Generated",
                        "criticality": "Low",
                        "passRate": 73.0,
                        "v3PassRate": 60.0,
                        "issueType": "Improved",
                        "analysisSummary": "IMPROVED from 60% to 73% with gpt-4o",
                        "specificIssue": "Better judge accuracy. Remaining failures are model not following count instructions.",
                        "expectedOutput": "{\"variations\": [\"v1\", \"v2\", \"v3\", \"v4\", \"v5\", \"v6\", \"v7\", \"v8\", \"v9\", \"v10\"]}",
                        "actualOutput": "{\"variations\": [\"v1\", \"v2\", \"v3\", \"v4\", \"v5\"]}",
                        "detailedSuggestion": "Low priority - acceptable performance.",
                        "promptChange": "<div style=\"background:#d4edda;color:#333;padding:10px;border-radius:5px;margin-bottom:10px;border:1px solid #28a745;\"><span style=\"color:#155724;font-weight:bold;\">IMPROVED +13%</span></div>V3: 60% -> V4: 73%",
                        "impact": "Improved",
                        "validated": true,
                        "experimentDate": "2026-01-16",
                        "experimentModel": "gpt-4o"
            },
            {
                        "module": "M01B",
                        "rubric": "All Rubrics",
                        "criticality": "None",
                        "passRate": 95.0,
                        "v3PassRate": 75.0,
                        "issueType": "Excellent",
                        "analysisSummary": "EXCELLENT - 95% pass rate, +20% improvement from V3",
                        "specificIssue": "No significant issues. Minor edge cases.",
                        "expectedOutput": "{\"sub_brands\": [\"ZKX Pro\", \"ZKX Elite\"]}",
                        "actualOutput": "{\"sub_brands\": [\"ZKX Pro\", \"ZKX Elite\"]}",
                        "detailedSuggestion": "No changes needed.",
                        "promptChange": "<div style=\"background:#d4edda;color:#333;padding:10px;border-radius:5px;margin-bottom:10px;border:1px solid #28a745;\"><span style=\"color:#155724;font-weight:bold;\">EXCELLENT +20%</span></div>V3: 75% -> V4: 95%",
                        "impact": "Excellent",
                        "validated": true,
                        "experimentDate": "2026-01-16",
                        "experimentModel": "gpt-4o"
            },
            {
                        "module": "M02",
                        "rubric": "All Rubrics",
                        "criticality": "None",
                        "passRate": 99.0,
                        "v3PassRate": 100.0,
                        "issueType": "Excellent",
                        "analysisSummary": "EXCELLENT - 99% pass rate",
                        "specificIssue": "Near perfect. One edge case failure.",
                        "expectedOutput": "{\"branding_scope_1\": \"OB\"}",
                        "actualOutput": "{\"branding_scope_1\": \"OB\"}",
                        "detailedSuggestion": "No changes needed.",
                        "promptChange": "<div style=\"background:#d4edda;color:#333;padding:10px;border-radius:5px;margin-bottom:10px;border:1px solid #28a745;\"><span style=\"color:#155724;font-weight:bold;\">EXCELLENT 99%</span></div>",
                        "impact": "Excellent",
                        "validated": true,
                        "experimentDate": "2026-01-16",
                        "experimentModel": "gpt-4o"
            },
            {
                        "module": "M04",
                        "rubric": "Correct CB/null Classification",
                        "criticality": "High",
                        "passRate": 33.0,
                        "issueType": "Prompt Issue",
                        "analysisSummary": "Prompt Issue - Case-insensitive matching instructions unclear",
                        "specificIssue": "Model misses competitor brand matches like 'oxo' -> 'OXO'. This is a PROMPT ISSUE - the prompt says 'Normalize the keyword' but doesn't explicitly say to normalize BOTH keyword AND competitor_entities list before comparison.",
                        "expectedOutput": "{\"branding_scope_2\": \"CB\"} for keyword 'oxo oven mitts' (OXO is in competitor list)",
                        "actualOutput": "{\"branding_scope_2\": \"\", \"reasoning\": \"Keyword contains 'oxo' which is not in the competitor_entities list\"}",
                        "detailedSuggestion": "Add explicit instruction to normalize BOTH keyword AND competitor list to lowercase before comparison. Include worked examples showing the normalization step.",
                        "promptChange": "<div style=\"background:#fff3cd;color:#333;padding:10px;border-radius:5px;margin-bottom:10px;border:1px solid #ffc107;\"><span style=\"color:#856404;font-weight:bold;\">PROMPT ISSUE - Improvement Suggested</span><br>Expected Improvement: 10-15%</div><hr><strong>SUGGESTED CHANGE TO: prompts/modules/m04_cb_nb_classification.md</strong><hr><pre style=\"background:#ffebee;padding:10px;font-size:11px;border-left:4px solid #c62828;\"><strong>OLD (Current):</strong>\n\n**Assign branding_scope_2 = \"CB\" when:**\n- Keyword contains an EXACT match to any competitor_entity (case-insensitive)\n- Keyword contains a FUZZY match from competitor_entities list\n- Competitor brand appears as a distinct word</pre><pre style=\"background:#e8f5e9;padding:10px;font-size:11px;border-left:4px solid #2e7d32;\"><strong>NEW (Suggested):</strong>\n\n**Assign branding_scope_2 = \"CB\" when:**\n- Keyword contains a competitor_entity match (ALWAYS compare case-insensitively)\n  - Example: keyword \"[brand] product\" matches \"[BRAND]\" in competitor_entities\n- Keyword contains a FUZZY match from competitor_entities list\n- Competitor brand appears as a distinct word\n\n**CRITICAL - Case-Insensitive Matching Process:**\n1. Take each competitor entity from the list\n2. Convert it to lowercase (e.g., \"[BRAND]\" -> \"[brand]\")\n3. Convert the keyword to lowercase (e.g., \"[Brand] Product\" -> \"[brand] product\")\n4. Check if the lowercased keyword contains the lowercased competitor\n5. If match found -> CB</pre>",
                        "impact": "High - Core classification failing",
                        "validated": false,
                        "validationStatus": "SUGGESTED",
                        "expectedImprovement": "10-15%",
                        "experimentDate": "2026-01-16",
                        "experimentModel": "gpt-4o"
            },
            {
                        "module": "M04",
                        "rubric": "Case Insensitive Matching",
                        "criticality": "Medium",
                        "passRate": 61.25,
                        "v3PassRate": 41.7,
                        "issueType": "Mixed (Judge + Model)",
                        "analysisSummary": "MIXED ISSUE - Some real failures (case mismatch), some judge interpretation",
                        "specificIssue": "Two types of failures: (1) REAL: Model fails lowercase to uppercase brand match. (2) JUDGE: Model correctly matches case variants but judge fails because reasoning doesn't say 'case-insensitive'.",
                        "expectedOutput": "{\"branding_scope_2\": \"CB\"} for keyword 'oven mitts oxo' (OXO is competitor)",
                        "actualOutput": "{\"branding_scope_2\": \"\", \"reasoning\": \"'oxo' is not in the provided competitor_entities list\"}",
                        "detailedSuggestion": "Two-part fix needed: (1) Update rubric to accept correct matches even without explicit 'case-insensitive' in reasoning. (2) Add prompt instruction to mention case-insensitivity in reasoning.",
                        "promptChange": "<div style=\"background:#17a2b8;color:#fff;padding:10px;border-radius:5px;margin-bottom:10px;border:1px solid #138496;\"><span style=\"font-weight:bold;\">MIXED ISSUE - Judge + Model</span></div><strong>Analysis:</strong> Model correctly matches case variants but judge fails because reasoning doesn't say 'case-insensitive'<br><br><strong>Pass rate improved:</strong> 41.7% -> 61.25% (+19.5%)<hr><strong>SUGGESTED PROMPT CHANGE:</strong><hr><pre style=\"background:#f5f5f5;padding:10px;font-size:11px;\">OLD (from M04 prompt line ~100):\n**Exact Match Examples:**\n- \"[brand] product\" contains \"[Brand]\" -> CB\n\nNEW:\n**Exact Match Examples (CASE-INSENSITIVE):**\n- \"[brand] product\" contains \"[Brand]\" -> CB\n  (Note in reasoning: '[brand]' matches '[Brand]' case-insensitively)\n\n**IMPORTANT:** When matching, always mention case-insensitivity in your reasoning if the case differs.</pre><hr><strong>SUGGESTED RUBRIC CHANGE:</strong><hr><pre style=\"background:#f5f5f5;padding:10px;font-size:11px;\">OLD:\nFAIL if case variations are not matched\n\nNEW:\nFAIL if case variations are not matched\nNOTE: If the model CORRECTLY classified CB for a case-variant match, PASS even if reasoning doesn't explicitly say 'case-insensitive'</pre>",
                        "impact": "Medium - Both prompt and rubric improvements suggested",
                        "validated": true,
                        "experimentDate": "2026-01-16",
                        "experimentModel": "gpt-4o"
            }
];

        const colors = {
            "PASS - correct": "#26de81",
            "PASS with variation": "#4ecdc4",
            "PASS with valid alternative": "#4ecdc4",
            "FAIL - null output": "#2d3436",
            "FAIL - duplicates found": "#e17055",
            "FAIL - hallucination detected": "#d63031",
            "FAIL - hallucination": "#d63031",
            "FAIL - format issue": "#fdcb6e",
            "FAIL - structure issue": "#fdcb6e",
            "FAIL - count issue": "#e17055",
            "FAIL - wrong classification": "#ff7675",
            "FAIL - matching error": "#fab1a0",
            "FAIL - model error": "#ff7675",
            "FAIL - ranking issue": "#e17055",
            "FAIL - constraint issue": "#e17055",
            "FAIL - unrelated terms": "#fab1a0",
            "FAIL - word count issue": "#fdcb6e",
            "FAIL - description issue": "#fdcb6e",
            "FAIL - classification error": "#ff7675"
        };

        let currentView = 'module';
        let activeFilter = 'all';

        function getIssueTypeClass(issueType) {
            if (issueType.includes('Prompt')) return 'prompt';
            if (issueType.includes('Model') && issueType.includes('Correct')) return 'correct';
            if (issueType.includes('Model')) return 'model';
            if (issueType.includes('Valid')) return 'valid';
            if (issueType.includes('Judge')) return 'judge';
            return '';
        }

        function init() {
            renderSidebar();
            document.getElementById('totalIssuesBadge').textContent = improvementSuggestions.length;
            selectModule('M01');
        }

        function renderSidebar() {
            const list = document.getElementById('moduleList');
            const modules = Object.keys(moduleData).sort((a, b) => {
                return moduleData[a].passRate - moduleData[b].passRate;
            });

            list.innerHTML = modules.map(id => {
                const m = moduleData[id];
                let rateClass = 'rate-critical';
                if (m.passRate >= 80) rateClass = 'rate-excellent';
                else if (m.passRate >= 60) rateClass = 'rate-good';
                else if (m.passRate >= 40) rateClass = 'rate-warning';

                return `
                    <li class="module-item" data-module="${id}" onclick="selectModule('${id}')">
                        <span class="module-name">${id}</span>
                        <span class="module-rate ${rateClass}">${m.passRate}%</span>
                    </li>
                `;
            }).join('');
        }

        function selectModule(moduleId) {
            currentView = 'module';
            document.querySelectorAll('.module-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.module === moduleId) {
                    item.classList.add('active');
                }
            });
            document.getElementById('suggestionsMenuItem').classList.remove('active');
            renderModuleContent(moduleId);
        }

        function showSuggestions() {
            currentView = 'suggestions';
            document.querySelectorAll('.module-item').forEach(item => item.classList.remove('active'));
            document.getElementById('suggestionsMenuItem').classList.add('active');
            renderSuggestionsContent();
        }

        function renderModuleContent(moduleId) {
            const m = moduleData[moduleId];
            const main = document.getElementById('mainContent');

            main.innerHTML = `
                <div class="module-header">
                    <h2>${m.name}</h2>
                    <p class="description">${m.description}</p>
                </div>

                <div class="stats-row">
                    <div class="stat-card">
                        <div class="label">Total</div>
                        <div class="value">${m.total}</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Pass</div>
                        <div class="value pass">${m.pass}</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Fail</div>
                        <div class="value fail">${m.fail}</div>
                    </div>
                    <div class="stat-card">
                        <div class="label">Pass Rate</div>
                        <div class="value">${m.passRate}%</div>
                    </div>
                </div>

                <div class="analysis-section">
                    <div class="chart-card">
                        <h3>Analysis Summary Distribution</h3>
                        <div class="chart-container">
                            <canvas id="analysisSummaryChart"></canvas>
                        </div>
                        <div class="chart-legend" id="chartLegend"></div>
                    </div>

                    <div class="table-card">
                        <h3>Analysis Details</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Issue Type</th>
                                    <th>Analysis Summary</th>
                                    <th>Specific Issue</th>
                                    <th>Expected Output</th>
                                    <th>Actual Output</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${m.analysisTable.map(row => `
                                    <tr>
                                        <td class="issue-type-cell ${getIssueTypeClass(row.issueType)}">${row.issueType}</td>
                                        <td class="analysis-summary-cell">${row.analysisSummary}</td>
                                        <td class="specific-issue-cell">${row.specificIssue}</td>
                                        <td><div class="output-cell">${row.expectedOutput}</div></td>
                                        <td><div class="output-cell">${row.actualOutput}</div></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>

                ${m.fixed.length > 0 ? `
                    <div class="fixed-section">
                        <h3>What's Been Fixed</h3>
                        ${m.fixed.map(f => `<div class="fixed-item">${f}</div>`).join('')}
                    </div>
                ` : ''}

                ${m.recommendations.length > 0 ? `
                    <div class="recommendations-section">
                        <h3>Recommendations</h3>
                        ${m.recommendations.map(r => `<div class="recommendation-item">${r}</div>`).join('')}
                    </div>
                ` : ''}
            `;

            renderAnalysisChart(m);
        }

        function renderSuggestionsContent() {
            const main = document.getElementById('mainContent');

            // Count by criticality
            const counts = {
                Critical: improvementSuggestions.filter(s => s.criticality === 'Critical').length,
                High: improvementSuggestions.filter(s => s.criticality === 'High').length,
                Medium: improvementSuggestions.filter(s => s.criticality === 'Medium').length,
                Low: improvementSuggestions.filter(s => s.criticality === 'Low').length
            };

            main.innerHTML = `
                <div class="suggestions-content">
                    <div class="module-header">
                        <h2>Improvement Suggestions</h2>
                        <p class="description">Detailed analysis of issues with specific prompt changes needed - sorted by criticality</p>
                    </div>

                    <div class="stats-row">
                        <div class="stat-card">
                            <div class="label">Critical</div>
                            <div class="value critical">${counts.Critical}</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">High</div>
                            <div class="value high">${counts.High}</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Medium</div>
                            <div class="value medium">${counts.Medium}</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Low</div>
                            <div class="value low">${counts.Low}</div>
                        </div>
                        <div class="stat-card">
                            <div class="label">Total Issues</div>
                            <div class="value">${improvementSuggestions.length}</div>
                        </div>
                    </div>

                    <div class="filter-tabs">
                        <button class="filter-tab ${activeFilter === 'all' ? 'active' : ''}" onclick="filterSuggestions('all')">All Issues</button>
                        <button class="filter-tab critical ${activeFilter === 'Critical' ? 'active' : ''}" onclick="filterSuggestions('Critical')">Critical (${counts.Critical})</button>
                        <button class="filter-tab high ${activeFilter === 'High' ? 'active' : ''}" onclick="filterSuggestions('High')">High (${counts.High})</button>
                        <button class="filter-tab medium ${activeFilter === 'Medium' ? 'active' : ''}" onclick="filterSuggestions('Medium')">Medium (${counts.Medium})</button>
                        <button class="filter-tab low ${activeFilter === 'Low' ? 'active' : ''}" onclick="filterSuggestions('Low')">Low (${counts.Low})</button>
                    </div>

                    <div id="suggestionsContainer"></div>
                </div>
            `;

            renderSuggestionCards();
        }

        function filterSuggestions(filter) {
            activeFilter = filter;
            renderSuggestionsContent();
        }

        function renderSuggestionCards() {
            const container = document.getElementById('suggestionsContainer');
            const filtered = activeFilter === 'all'
                ? improvementSuggestions
                : improvementSuggestions.filter(s => s.criticality === activeFilter);

            // Group by criticality
            const grouped = {};
            filtered.forEach(s => {
                if (!grouped[s.criticality]) grouped[s.criticality] = [];
                grouped[s.criticality].push(s);
            });

            const order = ['Critical', 'High', 'Medium', 'Low'];

            container.innerHTML = order
                .filter(crit => grouped[crit])
                .map(crit => `
                    <div class="criticality-section">
                        <div class="criticality-header ${crit.toLowerCase()}">
                            <span class="criticality-badge ${crit.toLowerCase()}">${crit}</span>
                            <span class="criticality-title">${crit} Priority</span>
                            <span class="criticality-count">${grouped[crit].length} issues</span>
                        </div>
                        ${grouped[crit].map(s => renderSuggestionCard(s)).join('')}
                    </div>
                `).join('');
        }

        function renderSuggestionCard(s) {
            const issueTypeClass = s.issueType.includes('Prompt') ? 'prompt' : 'model';
            return `
                <div class="suggestion-card ${s.criticality.toLowerCase()}">
                    <div class="suggestion-header">
                        <span class="module-badge">${s.module}</span>
                        <span class="issue-type-badge ${issueTypeClass}">${s.issueType}</span>
                        <span class="analysis-summary-cell">${s.analysisSummary}</span>
                        <span class="pass-rate-badge">Pass Rate: ${s.passRate}%</span>
                    </div>
                    <div class="suggestion-body">
                        <div class="issue-description">
                            <h4>Issue Analysis</h4>
                            <p>${s.specificIssue}</p>
                        </div>
                        <div class="output-comparison">
                            <div class="output-box expected">
                                <h5>Expected Output</h5>
                                <pre>${s.expectedOutput}</pre>
                            </div>
                            <div class="output-box actual">
                                <h5>Actual Output</h5>
                                <pre>${s.actualOutput}</pre>
                            </div>
                        </div>
                        <div class="detailed-suggestion">
                            <h4>Recommended Fix</h4>
                            <div class="suggestion-text">${s.detailedSuggestion}</div>
                            <div class="prompt-change">${s.promptChange}</div>
                            <span class="impact-badge">${s.impact}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderAnalysisChart(m) {
            const labels = Object.keys(m.analysisSummary);
            const values = Object.values(m.analysisSummary);
            const chartColors = labels.map(l => colors[l] || '#888');

            new Chart(document.getElementById('analysisSummaryChart'), {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: values,
                        backgroundColor: chartColors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    }
                }
            });

            const legendHtml = labels.map((label, i) => `
                <div class="legend-item">
                    <div class="legend-color" style="background: ${chartColors[i]}"></div>
                    <span>${label} (${values[i]})</span>
                </div>
            `).join('');
            document.getElementById('chartLegend').innerHTML = legendHtml;
        }

        init();
    </script>
</body>
</html>
