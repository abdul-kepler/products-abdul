<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improvement Suggestions V4 - Validated Iterations</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 30px;
            color: #fff;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 32px;
            background: linear-gradient(90deg, #4ecdc4, #44a08d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        .header p { color: #8892b0; font-size: 14px; }

        /* Summary Cards */
        .summary-row {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        .summary-card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px 30px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.1);
            min-width: 150px;
        }
        .summary-card .label {
            font-size: 11px;
            color: #8892b0;
            text-transform: uppercase;
            margin-bottom: 8px;
        }
        .summary-card .value {
            font-size: 36px;
            font-weight: 700;
        }
        .summary-card .value.validated { color: #4ecdc4; }
        .summary-card .value.suggested { color: #f39c12; }
        .summary-card .value.model { color: #e74c3c; }

        /* Validated Section */
        .section {
            background: rgba(255,255,255,0.03);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .section-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }
        .section-badge.validated { background: linear-gradient(135deg, #4ecdc4, #44a08d); color: #1a1a2e; }
        .section-badge.suggested { background: #f39c12; color: #1a1a2e; }
        .section-badge.model { background: #e74c3c; color: white; }
        .section-title { font-size: 20px; color: #fff; }

        /* Improvement Cards */
        .improvement-card {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid;
        }
        .improvement-card.validated { border-left-color: #4ecdc4; }
        .improvement-card.suggested { border-left-color: #f39c12; }
        .improvement-card.model { border-left-color: #e74c3c; }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }
        .module-badge {
            background: #4ecdc4;
            color: #1a1a2e;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 700;
        }
        .rubric-name {
            font-size: 16px;
            font-weight: 600;
            color: #fff;
        }
        .improvement-badge {
            margin-left: auto;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 700;
        }
        .improvement-badge.green { background: rgba(78, 205, 196, 0.2); color: #4ecdc4; }
        .improvement-badge.yellow { background: rgba(243, 156, 18, 0.2); color: #f39c12; }

        /* Analysis Summary Box */
        .analysis-summary {
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 8px;
            padding: 12px 15px;
            margin: 10px 0 15px 0;
        }
        .analysis-summary-label {
            font-size: 10px;
            color: #4ecdc4;
            text-transform: uppercase;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .analysis-summary-text {
            font-size: 14px;
            color: #fff;
            font-weight: 500;
            line-height: 1.4;
        }
        .analysis-summary.suggested {
            background: rgba(243, 156, 18, 0.1);
            border-color: rgba(243, 156, 18, 0.3);
        }
        .analysis-summary.suggested .analysis-summary-label {
            color: #f39c12;
        }
        .analysis-summary.model {
            background: rgba(231, 76, 60, 0.1);
            border-color: rgba(231, 76, 60, 0.3);
        }
        .analysis-summary.model .analysis-summary-label {
            color: #e74c3c;
        }

        /* Iteration Chart */
        .iteration-chart {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        .chart-title {
            font-size: 12px;
            color: #8892b0;
            margin-bottom: 15px;
            text-transform: uppercase;
        }
        .chart-bars {
            display: flex;
            align-items: flex-end;
            gap: 4px;
            height: 100px;
        }
        .chart-bar {
            flex: 1;
            background: linear-gradient(180deg, #4ecdc4, #44a08d);
            border-radius: 3px 3px 0 0;
            position: relative;
            min-width: 20px;
            transition: all 0.3s ease;
        }
        .chart-bar:hover {
            filter: brightness(1.2);
        }
        .chart-bar.best {
            background: linear-gradient(180deg, #ffd700, #ff8c00);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }
        .chart-bar-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            color: #8892b0;
        }
        .chart-bar-value {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            color: #4ecdc4;
            font-weight: 600;
        }
        .chart-legend {
            display: flex;
            gap: 20px;
            margin-top: 25px;
            justify-content: center;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 11px;
            color: #8892b0;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }
        .legend-dot.normal { background: linear-gradient(180deg, #4ecdc4, #44a08d); }
        .legend-dot.best { background: linear-gradient(180deg, #ffd700, #ff8c00); }
        .legend-dot.baseline { background: #e74c3c; }

        /* Suggestion Box */
        .suggestion-box {
            background: rgba(78, 205, 196, 0.1);
            border: 1px solid rgba(78, 205, 196, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }
        .suggestion-box h4 {
            color: #4ecdc4;
            font-size: 13px;
            margin-bottom: 10px;
        }
        .suggestion-box pre {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 6px;
            font-size: 11px;
            color: #a8b2d1;
            overflow-x: auto;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', monospace;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin: 15px 0;
        }
        .stat-item {
            background: rgba(0,0,0,0.2);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-label {
            font-size: 10px;
            color: #8892b0;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: #4ecdc4;
        }
        .stat-value.highlight { color: #ffd700; }

        /* Issue Type Badge */
        .issue-type {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }
        .issue-type.prompt { background: rgba(243, 156, 18, 0.2); color: #f39c12; }
        .issue-type.model { background: rgba(231, 76, 60, 0.2); color: #e74c3c; }
        .issue-type.judge { background: rgba(52, 152, 219, 0.2); color: #3498db; }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: #8892b0;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Improvement Suggestions V4</h1>
        <p>Validated prompt improvements from 15-iteration experiments | Generated: 2026-01-16</p>
    </div>

    <div class="summary-row">
        <div class="summary-card">
            <div class="label">Validated</div>
            <div class="value validated">2</div>
        </div>
        <div class="summary-card">
            <div class="label">Suggested</div>
            <div class="value suggested">3</div>
        </div>
        <div class="summary-card">
            <div class="label">Model Issues</div>
            <div class="value model">1</div>
        </div>
        <div class="summary-card">
            <div class="label">Improved</div>
            <div class="value validated">4</div>
        </div>
    </div>

    <!-- VALIDATED IMPROVEMENTS -->
    <div class="section">
        <div class="section-header">
            <span class="section-badge validated">Validated</span>
            <span class="section-title">Experimentally Validated Improvements</span>
        </div>

        <!-- M01 No Duplicate Entities -->
        <div class="improvement-card validated">
            <div class="card-header">
                <span class="module-badge">M01</span>
                <span class="rubric-name">No Duplicate Entities</span>
                <span class="issue-type prompt">Prompt Issue</span>
                <span class="improvement-badge green">+100% Improvement</span>
            </div>

            <div class="analysis-summary">
                <div class="analysis-summary-label">Analysis Summary</div>
                <div class="analysis-summary-text">Prompt Issue - VALIDATED: 40% → 80% improvement with set-based thinking instruction</div>
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">Baseline</div>
                    <div class="stat-value">40%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Best Result</div>
                    <div class="stat-value highlight">80%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Best Iteration</div>
                    <div class="stat-value">#5</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Total Iterations</div>
                    <div class="stat-value">15</div>
                </div>
            </div>

            <div class="iteration-chart">
                <div class="chart-title">Pass Rate by Iteration (20 samples each)</div>
                <div class="chart-bars">
                    <div class="chart-bar" style="height: 40%"><span class="chart-bar-label">B</span><span class="chart-bar-value">40%</span></div>
                    <div class="chart-bar" style="height: 30%"><span class="chart-bar-label">1</span><span class="chart-bar-value">30%</span></div>
                    <div class="chart-bar" style="height: 50%"><span class="chart-bar-label">2</span><span class="chart-bar-value">50%</span></div>
                    <div class="chart-bar" style="height: 40%"><span class="chart-bar-label">3</span><span class="chart-bar-value">40%</span></div>
                    <div class="chart-bar" style="height: 20%"><span class="chart-bar-label">4</span><span class="chart-bar-value">20%</span></div>
                    <div class="chart-bar best" style="height: 80%"><span class="chart-bar-label">5</span><span class="chart-bar-value">80%</span></div>
                    <div class="chart-bar" style="height: 70%"><span class="chart-bar-label">6</span><span class="chart-bar-value">70%</span></div>
                    <div class="chart-bar" style="height: 80%"><span class="chart-bar-label">7</span><span class="chart-bar-value">80%</span></div>
                    <div class="chart-bar" style="height: 60%"><span class="chart-bar-label">8</span><span class="chart-bar-value">60%</span></div>
                    <div class="chart-bar" style="height: 60%"><span class="chart-bar-label">9</span><span class="chart-bar-value">60%</span></div>
                    <div class="chart-bar" style="height: 50%"><span class="chart-bar-label">10</span><span class="chart-bar-value">50%</span></div>
                    <div class="chart-bar" style="height: 60%"><span class="chart-bar-label">11</span><span class="chart-bar-value">60%</span></div>
                    <div class="chart-bar" style="height: 40%"><span class="chart-bar-label">12</span><span class="chart-bar-value">40%</span></div>
                    <div class="chart-bar" style="height: 60%"><span class="chart-bar-label">13</span><span class="chart-bar-value">60%</span></div>
                    <div class="chart-bar" style="height: 50%"><span class="chart-bar-label">14</span><span class="chart-bar-value">50%</span></div>
                    <div class="chart-bar" style="height: 80%"><span class="chart-bar-label">15</span><span class="chart-bar-value">80%</span></div>
                </div>
                <div class="chart-legend">
                    <div class="legend-item"><div class="legend-dot baseline"></div>Baseline</div>
                    <div class="legend-item"><div class="legend-dot normal"></div>Iteration</div>
                    <div class="legend-item"><div class="legend-dot best"></div>Best Result</div>
                </div>
            </div>

            <div class="suggestion-box">
                <h4>Best Prompt Addition (Iteration #5 - Set-Based Thinking)</h4>
                <pre>## THINK OF YOUR OUTPUT AS A SET

**Mathematical set = NO DUPLICATES ALLOWED**

Before outputting, verify:
- Set {"[Brand]", "[brand]", "[Brnd]"} valid - all unique
- Set {"[Brand]", "[brand]", "[Brand]"} invalid - "[Brand]" appears twice

**If you see a string twice, your output is INVALID.**</pre>
            </div>
        </div>

        <!-- M04 CB Classification -->
        <div class="improvement-card validated">
            <div class="card-header">
                <span class="module-badge">M04</span>
                <span class="rubric-name">Correct CB/null Classification</span>
                <span class="issue-type prompt">Prompt Issue</span>
                <span class="improvement-badge green">+75% Improvement</span>
            </div>

            <div class="analysis-summary">
                <div class="analysis-summary-label">Analysis Summary</div>
                <div class="analysis-summary-text">Prompt Issue - VALIDATED: 50% → 87.5% improvement with explicit case-insensitive matching rule</div>
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">Baseline</div>
                    <div class="stat-value">50%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Best Result</div>
                    <div class="stat-value highlight">87.5%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Best Iteration</div>
                    <div class="stat-value">#6</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Total Iterations</div>
                    <div class="stat-value">15</div>
                </div>
            </div>

            <div class="iteration-chart">
                <div class="chart-title">Pass Rate by Iteration (8 samples each)</div>
                <div class="chart-bars">
                    <div class="chart-bar" style="height: 50%"><span class="chart-bar-label">B</span><span class="chart-bar-value">50%</span></div>
                    <div class="chart-bar" style="height: 62.5%"><span class="chart-bar-label">1</span><span class="chart-bar-value">63%</span></div>
                    <div class="chart-bar" style="height: 75%"><span class="chart-bar-label">2</span><span class="chart-bar-value">75%</span></div>
                    <div class="chart-bar" style="height: 62.5%"><span class="chart-bar-label">3</span><span class="chart-bar-value">63%</span></div>
                    <div class="chart-bar" style="height: 62.5%"><span class="chart-bar-label">4</span><span class="chart-bar-value">63%</span></div>
                    <div class="chart-bar" style="height: 62.5%"><span class="chart-bar-label">5</span><span class="chart-bar-value">63%</span></div>
                    <div class="chart-bar best" style="height: 87.5%"><span class="chart-bar-label">6</span><span class="chart-bar-value">88%</span></div>
                    <div class="chart-bar" style="height: 87.5%"><span class="chart-bar-label">7</span><span class="chart-bar-value">88%</span></div>
                    <div class="chart-bar" style="height: 37.5%"><span class="chart-bar-label">8</span><span class="chart-bar-value">38%</span></div>
                    <div class="chart-bar" style="height: 50%"><span class="chart-bar-label">9</span><span class="chart-bar-value">50%</span></div>
                    <div class="chart-bar" style="height: 62.5%"><span class="chart-bar-label">10</span><span class="chart-bar-value">63%</span></div>
                    <div class="chart-bar" style="height: 87.5%"><span class="chart-bar-label">11</span><span class="chart-bar-value">88%</span></div>
                    <div class="chart-bar" style="height: 75%"><span class="chart-bar-label">12</span><span class="chart-bar-value">75%</span></div>
                    <div class="chart-bar" style="height: 62.5%"><span class="chart-bar-label">13</span><span class="chart-bar-value">63%</span></div>
                    <div class="chart-bar" style="height: 75%"><span class="chart-bar-label">14</span><span class="chart-bar-value">75%</span></div>
                    <div class="chart-bar" style="height: 62.5%"><span class="chart-bar-label">15</span><span class="chart-bar-value">63%</span></div>
                </div>
                <div class="chart-legend">
                    <div class="legend-item"><div class="legend-dot baseline"></div>Baseline</div>
                    <div class="legend-item"><div class="legend-dot normal"></div>Iteration</div>
                    <div class="legend-item"><div class="legend-dot best"></div>Best Result</div>
                </div>
            </div>

            <div class="suggestion-box">
                <h4>Best Prompt Addition (Iteration #6 - Critical Case Rule)</h4>
                <pre>## CRITICAL RULE: CASE DOES NOT MATTER

**This is the #1 cause of errors. Fix it by:**

1. ALWAYS lowercase the keyword first
2. ALWAYS lowercase each competitor before checking
3. NEVER skip a match because of case differences

**If you see "[brand]" in keyword and "[BRAND]" in competitor list:**
- This IS a match
- Return CB
- Do NOT return null

**If you return null when a competitor IS in the keyword (different case), you have FAILED.**</pre>
            </div>
        </div>
    </div>

    <!-- SUGGESTED (Not Yet Validated) -->
    <div class="section">
        <div class="section-header">
            <span class="section-badge suggested">Suggested</span>
            <span class="section-title">Pending Validation</span>
        </div>

        <div class="improvement-card suggested">
            <div class="card-header">
                <span class="module-badge">M01</span>
                <span class="rubric-name">Amazon Test Applied</span>
                <span class="issue-type prompt">Prompt Issue</span>
                <span class="improvement-badge yellow">7% Pass Rate</span>
            </div>

            <div class="analysis-summary suggested">
                <div class="analysis-summary-label">Analysis Summary</div>
                <div class="analysis-summary-text">Prompt Issue - Amazon Test instructions need explicit sub-brand rules</div>
            </div>

            <p style="color: #a8b2d1; margin: 10px 0; font-size: 13px;">
                Model includes entities that fail the Amazon Test (like sub-brand components).
                Experiment partially run - some iterations reached 95-100% but blocked by permission issues.
            </p>
            <div class="suggestion-box">
                <h4>Suggested: Add Sub-brand Output Rules</h4>
                <pre>### CRITICAL: Apply Amazon Test to EVERY word in multi-word entities

When you have a sub-brand like "[Brand] [SubBrand]", test EACH word:
1. Test "[SubBrand]" alone: Can you buy a "[SubBrand]" on Amazon?
   - If "[SubBrand]" is a common word -> REMOVE the entire entity
   - If "[SubBrand]" is ONLY used as this brand's trademark -> KEEP

**Common words that FAIL the Amazon Test when used in sub-brands:**
- beam, wave, pro, max, plus, ultra -> generic product modifiers</pre>
            </div>
        </div>

        <div class="improvement-card suggested">
            <div class="card-header">
                <span class="module-badge">M01</span>
                <span class="rubric-name">Brand Extracted</span>
                <span class="issue-type prompt">Prompt Issue</span>
                <span class="improvement-badge yellow">20% Pass Rate</span>
            </div>

            <div class="analysis-summary suggested">
                <div class="analysis-summary-label">Analysis Summary</div>
                <div class="analysis-summary-text">Prompt Issue - Typo generation rules need priority ordering for diverse misspellings</div>
            </div>

            <p style="color: #a8b2d1; margin: 10px 0; font-size: 13px;">
                Typo generation rules need priority ordering. Model generates excessive duplicate case variants
                and insufficient phonetic typos. Experiment not completed due to permission issues.
            </p>
            <div class="suggestion-box">
                <h4>Suggested: Priority-Ordered Typo Generation</h4>
                <pre>### Step 2: Generate Typos (MANDATORY - 4-6 UNIQUE per brand)

Generate DIVERSE misspellings. **Prioritize phonetic typos over case changes.**

| Typo Type | Priority | How to Apply |
|-----------|----------|--------------|
| Missing letter | HIGH | Remove vowel: [Brand]->[Brnd] |
| Swapped adjacent | HIGH | Swap 2 adjacent: [Brand]->[Barnd] |
| Phonetic substitution | HIGH | Similar sound: 'y'->'ie' |
| Case variation | LOW | Only ONE lowercase per brand |</pre>
            </div>
        </div>
    </div>

    <!-- MODEL ISSUES -->
    <div class="section">
        <div class="section-header">
            <span class="section-badge model">Model Limitation</span>
            <span class="section-title">True Model Capability Issues</span>
        </div>

        <div class="improvement-card model">
            <div class="card-header">
                <span class="module-badge">M01</span>
                <span class="rubric-name">No Hallucinated Brand</span>
                <span class="issue-type model">Model Issue</span>
                <span class="improvement-badge yellow">27% Pass Rate</span>
            </div>

            <div class="analysis-summary model">
                <div class="analysis-summary-label">Analysis Summary</div>
                <div class="analysis-summary-text">Model Issue - LLM hallucinating brand names not in input (true capability limitation)</div>
            </div>

            <p style="color: #a8b2d1; margin: 10px 0; font-size: 13px;">
                True model limitation - LLM generates typos like 'Cisilyy' (double-y ending) that don't follow valid patterns.
                Prompt improvements can only achieve 10-25% improvement. Consider validation layer or fine-tuning for significant gains.
            </p>
        </div>
    </div>

    <!-- ALREADY IMPROVED -->
    <div class="section">
        <div class="section-header">
            <span class="section-badge validated">Excellent</span>
            <span class="section-title">Already High Performing (No Changes Needed)</span>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
            <div class="improvement-card validated" style="border-left-color: #27ae60;">
                <div class="card-header">
                    <span class="module-badge">M01B</span>
                    <span class="rubric-name">All Rubrics</span>
                    <span class="improvement-badge green">95% Pass</span>
                </div>
                <p style="color: #27ae60; font-size: 12px; margin-top: 5px;">+20% from V3</p>
            </div>
            <div class="improvement-card validated" style="border-left-color: #27ae60;">
                <div class="card-header">
                    <span class="module-badge">M02</span>
                    <span class="rubric-name">All Rubrics</span>
                    <span class="improvement-badge green">99% Pass</span>
                </div>
                <p style="color: #27ae60; font-size: 12px; margin-top: 5px;">Production Ready</p>
            </div>
            <div class="improvement-card validated" style="border-left-color: #27ae60;">
                <div class="card-header">
                    <span class="module-badge">M01A</span>
                    <span class="rubric-name">8-12 Variations</span>
                    <span class="improvement-badge green">73% Pass</span>
                </div>
                <p style="color: #27ae60; font-size: 12px; margin-top: 5px;">+13% from V3</p>
            </div>
            <div class="improvement-card validated" style="border-left-color: #27ae60;">
                <div class="card-header">
                    <span class="module-badge">M04</span>
                    <span class="rubric-name">Case Insensitive</span>
                    <span class="improvement-badge green">61% Pass</span>
                </div>
                <p style="color: #27ae60; font-size: 12px; margin-top: 5px;">+20% from V3</p>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>Generated by LLM-as-a-Judge Evaluation Framework | Experiment V4 | gpt-4o Judge</p>
        <p style="margin-top: 5px;">2 validated improvements ready to apply | 3 suggestions pending validation</p>
    </div>
</body>
</html>
